<!DOCTYPE html>
<html lang="en" dir="ltr" class="spectrum spectrum--medium spectrum--lightest">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Serialized to JSON data upgrade | Archived 2.3 Magento Developer Guide</title>
	<meta name="description" content="Magento Developer Guide">

	<link rel="stylesheet" href="https://use.typekit.net/iaw1apr.css">
	<link rel="stylesheet" href="/devdocs-archive/2.3/assets/css/app.css?ver=20" />
	<link rel="stylesheet" href="/devdocs-archive/2.3/assets/css/print.css?ver=20" media="print" />
	<script src="https://assets.adobedtm.com/a7d65461e54e/f87b70cb627a/launch-b042bff6c581.min.js" async></script>

	<link rel="stylesheet" href="/devdocs-archive/2.3/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />
<meta name="google-site-verification" content="3WFsoYwBe6UuxDwgs7bmd7t0YFQVzDpLpWLjNh0CUp8" />

	<script>
  var baseUrl = "/devdocs-archive/2.3";
  var algolia = {
    id: "E642SEDTHL",
    index: "devdocs",
    key: "d2d0f33ab73e291ef8d88d8b565e754c",
  };

  var indices = [{
      label: "Results",
      name: "devdocs",
      facetFilters: [
        ["guide_version: 2.3",
          "versionless: true"
        ]
      ],
      refinements: [{
        label: "Functional areas",
        attribute: "functional_areas"
      }],
      baseUrl: "/devdocs-archive/2.3"
    }
  ];

</script>




	<link rel="icon" href="https://www.adobe.com/favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://adobe.com/favicon.ico">

</head>

<body class="layout-default">

	<header class="site-header">

		

<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" href="/devdocs-archive/2.3/">
      <img class="logo-image" src="/devdocs-archive/2.3/assets/i/adobe-a.svg" alt="Adobe">
      <span class="logo-text">Adobe</span>
      <span class="site-logo">Commerce DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      <!-- Main Navigation --><ul class="nav-main spectrum-Tabs spectrum-Tabs--sizeM spectrum-Tabs--horizontal" role="menubar"><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Cloud</span><div class="nav-popup spectrum-Popover"><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">Cloud basics</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/overview.html" class="spectrum-Menu-itemLabel ">Cloud Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/architecture/cloud-architecture.html" class="spectrum-Menu-itemLabel ">Cloud Architecture</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/project/file-structure.html" class="spectrum-Menu-itemLabel ">Project Structure</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/best-practices.html" class="spectrum-Menu-itemLabel ">Upgrades and Patches</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/release-notes/cloud-tools-suite.html" class="spectrum-Menu-itemLabel ">Release Notes</a></li></ul>
            </div><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">Cloud development</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/cloud-tools/docker/" class="spectrum-Menu-itemLabel ">Local development</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/cloud-tools/docker/configure/" class="spectrum-Menu-itemLabel ">Configure and launch Docker</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/cloud-tools/docker/quick-reference/" class="spectrum-Menu-itemLabel ">Docker quick reference</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/configure/app/configure-app-yaml.html" class="spectrum-Menu-itemLabel ">Configure Application</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/configure/env/configure-env-yaml.html" class="spectrum-Menu-itemLabel ">Configure Environments</a></li></ul>
            </div><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">Functional Testing</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/cloud-tools/docker/test/application-testing/" class="spectrum-Menu-itemLabel ">Application testing</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/cloud-tools/docker/test/code-testing/" class="spectrum-Menu-itemLabel ">Cloud code testing</a></li></ul>
            </div></div></li><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Setup</span><div class="nav-popup spectrum-Popover"><ul><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/install-gde/install-flow-diagram.html" class="spectrum-Menu-itemLabel ">Installation Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-admin/start/resources/extensions.html" class="spectrum-Menu-itemLabel ">Extensions Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/comp-mgr/bk-compman-upgrade-guide.html" class="spectrum-Menu-itemLabel ">Software Update Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/config-guide/bk-config-guide.html" class="spectrum-Menu-itemLabel ">Configuration Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/performance-best-practices/introduction.html" class="spectrum-Menu-itemLabel ">Performance Best Practices</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/migration/bk-migration-guide.html" class="spectrum-Menu-itemLabel ">Migration Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-operations/release/notes/overview.html" class="spectrum-Menu-itemLabel ">Release Information</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/reference/cli/magento.html" class="spectrum-Menu-itemLabel ">Command-line Tools Reference</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-operations/tools/overview.html" class="spectrum-Menu-itemLabel ">Tools</a></li></ul></div></li><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Development</span><div class="nav-popup spectrum-Popover"><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">Backend</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/architecture/bk-architecture.html" class="spectrum-Menu-itemLabel ">Architecture</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/extension-dev-guide/bk-extension-dev-guide.html" class="spectrum-Menu-itemLabel ">PHP Developer Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/bk-ext-best-practices.html" class="spectrum-Menu-itemLabel ">Extension Developer Best Practices</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/mrg/intro.html" class="spectrum-Menu-itemLabel ">Module Reference Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/coding-standards/bk-coding-standards.html" class="spectrum-Menu-itemLabel ">Coding Standards</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/contributor/guides/" class="spectrum-Menu-itemLabel ">Contributor Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/contributor/community/" class="spectrum-Menu-itemLabel ">Contribution Resources</a></li></ul>
            </div><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">Frontend</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/frontend-dev-guide/bk-frontend-dev-guide.html" class="spectrum-Menu-itemLabel ">Frontend Developer Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ui_comp_guide/bk-ui_comps.html" class="spectrum-Menu-itemLabel ">UI Components Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/javascript-dev-guide/bk-javascript-dev-guide.html" class="spectrum-Menu-itemLabel ">JavaScript Developer Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/pattern-library/bk-pattern.html" class="spectrum-Menu-itemLabel ">Admin Design Pattern Library</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/design-styleguide/bk-styleguide.html" class="spectrum-Menu-itemLabel ">Admin Style Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/pwa-studio/" class="spectrum-Menu-itemLabel ">PWA Documentation Site</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/frontend-core/page-builder/" class="spectrum-Menu-itemLabel ">Page Builder Developer Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="spectrum-Menu-sectionHeading">API</div>
              <ul class="spectrum-Menu"><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/get-started/bk-get-started-api.html" class="spectrum-Menu-itemLabel ">Get Started with our Web APIs</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/rest/bk-rest.html" class="spectrum-Menu-itemLabel ">REST API Reference</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/soap/bk-soap.html" class="spectrum-Menu-itemLabel ">SOAP API Reference</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/graphql/" class="spectrum-Menu-itemLabel ">GraphQL Developer Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/marketplace/guides/eqp/v1/" class="spectrum-Menu-itemLabel ">Marketplace EQP API Reference</a></li></ul>
            </div></div></li><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Testing</span><div class="nav-popup spectrum-Popover"><ul><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/test/testing.html" class="spectrum-Menu-itemLabel ">Application Testing Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://devdocs.magento.com/mftf/v2/docs/introduction.html" class="spectrum-Menu-itemLabel ">Functional Acceptance Testing (MFTF)</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/test/integration/integration_test_execution.html" class="spectrum-Menu-itemLabel ">Integration Testing</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/test/js/jasmine.html" class="spectrum-Menu-itemLabel ">JavaScript Unit Testing</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/test/unit/unit_test_execution.html" class="spectrum-Menu-itemLabel ">PHP Unit Testing</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/get-started/web-api-functional-testing.html" class="spectrum-Menu-itemLabel ">Web API Functional Testing</a></li></ul></div></li><li class="nav-main-separator"></li><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Functional Areas</span><div class="nav-popup spectrum-Popover"><ul><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/advanced-reporting/overview.html" class="spectrum-Menu-itemLabel ">Advanced Reporting</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/b2b/bk-b2b.html" class="spectrum-Menu-itemLabel ">B2B</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-merchant-services/catalog-service/overview.html" class="spectrum-Menu-itemLabel ">Catalog Service</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/howdoi/checkout/checkout_overview.html" class="spectrum-Menu-itemLabel ">Checkout</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/inventory/index.html" class="spectrum-Menu-itemLabel ">Inventory Management</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-merchant-services/live-search/guide-overview.html" class="spectrum-Menu-itemLabel ">Live Search</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/marketplace/guides/sellers/" class="spectrum-Menu-itemLabel ">Commerce Marketplace</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-merchant-services/payment-services/guide-overview.html" class="spectrum-Menu-itemLabel ">Payment Services</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://omsdocs.magento.com/en/" class="spectrum-Menu-itemLabel ">Order Management</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/frontend-core/page-builder/" class="spectrum-Menu-itemLabel ">Page Builder</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-merchant-services/product-recommendations/developer/development-overview.html" class="spectrum-Menu-itemLabel ">Product Recommendations Developer Guide</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-operations/security-and-compliance/overview.html" class="spectrum-Menu-itemLabel ">Security and Compliance</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/services/shared-services/" class="spectrum-Menu-itemLabel ">Shared Services</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/extension-dev-guide/staging.html" class="spectrum-Menu-itemLabel ">Staging</a></li></ul></div></li><li class="nav-main-item spectrum-Tabs-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span class="spectrum-Tabs-itemLabel" tabindex="-1">Tutorials</span><div class="nav-popup spectrum-Popover"><ul><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/rest/tutorials/index.html" class="spectrum-Menu-itemLabel ">Rest Tutorials</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/howdoi/custom-attributes/introduction.html" class="spectrum-Menu-itemLabel ">Custom Attributes</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/howdoi/customize_product.html" class="spectrum-Menu-itemLabel ">Customize Product Creation Form</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/howdoi/checkout/checkout_overview.html" class="spectrum-Menu-itemLabel ">Customize Checkout</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://developer.adobe.com/commerce/contributor/community/support/" class="spectrum-Menu-itemLabel ">Support</a></li><li class="  spectrum-Menu-item" role="menuitem"><a href="https://experienceleague.adobe.com/docs/commerce-learn/tutorials/overview.html" class="spectrum-Menu-itemLabel ">Video Tutorials</a></li></ul></div></li></ul><!-- /.nav-main -->

    </div>

    <div class="nav-actions">
      <div class="version-switcher">
	<button class="spectrum-Picker spectrum-Picker--sizeM dropdown-toggle" disabled>
		<span class="spectrum-Picker-label">Version 2.3</span>
	</button>
</div>
    </div>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>


	</header>

	<div class="global-wrapper">

		

		<div class="main-container">
			<a id="main-content"></a>

<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<button class="toc-toggler">Table of Contents</button>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Extension Best Practices</h4>
		
		<div class="collapsible-navigation">
		  <ul class="spectrum-SideNav spectrum-SideNav--multiLevel"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/bk-ext-best-practices.html" class="spectrum-SideNav-itemLink ">Introduction</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/admin/admin-best-practices.html" class="spectrum-SideNav-itemLink ">Admin</a><ul class="spectrum-SideNav"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/admin/placement-and-design.html" class="spectrum-SideNav-itemLink ">Admin Panel Placement and Design</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/admin/ext-best-practices_admin_FAQ.html" class="spectrum-SideNav-itemLink ">Admin FAQ</a></li></ul></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/coding-best-practices.html" class="spectrum-SideNav-itemLink ">Extension Coding</a><ul class="spectrum-SideNav"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/common-programming-bp.html" class="spectrum-SideNav-itemLink ">Programming best practices</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/working-with-arch-bp.html" class="spectrum-SideNav-itemLink ">Working with the Architecture</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/security-performance-data-bp.html" class="spectrum-SideNav-itemLink ">Security, performance, and data handling</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/observers-bp.html" class="spectrum-SideNav-itemLink ">Observers best practices</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/coding-faq.html" class="spectrum-SideNav-itemLink ">Coding FAQ</a></li></ul></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/introduction.html" class="spectrum-SideNav-itemLink ">PHPStorm plugin</a><ul class="spectrum-SideNav"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/installation.html" class="spectrum-SideNav-itemLink ">Installation</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/code-generation.html" class="spectrum-SideNav-itemLink ">Code generation</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/code-inspection.html" class="spectrum-SideNav-itemLink ">Code inspection</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/adding-code-inspections.html" class="spectrum-SideNav-itemLink ">Adding code inspections</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/new-features.html" class="spectrum-SideNav-itemLink ">New features</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/issue-reporting.html" class="spectrum-SideNav-itemLink ">Issue reporting</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/uct-run-configuration.html" class="spectrum-SideNav-itemLink ">Run the Upgrade Compatibility Tool</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/phpstorm/built-in-upgrade-compatibility-tool.html" class="spectrum-SideNav-itemLink ">The built-in Upgrade Compatibility Tool (MVP)</a></li></ul></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/storefront/storefront-best-practices.html" class="spectrum-SideNav-itemLink ">Storefront</a></li><li class="  spectrum-SideNav-item" role="menuitem"><span class="spectrum-SideNav-itemLink ">Security</span><ul class="spectrum-SideNav"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/security/writing-secure-code.html" class="spectrum-SideNav-itemLink ">Writing secure code</a></li></ul></li><li class="  spectrum-SideNav-item" role="menuitem"><span class="spectrum-SideNav-itemLink ">Tutorials</span><ul class="spectrum-SideNav"><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/copy-fieldsets.html" class="spectrum-SideNav-itemLink ">Copying fieldsets</a></li><li class="is-selected  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/serialized-to-json-data-upgrade.html" class="spectrum-SideNav-itemLink ">Serialized to JSON data upgrade</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/modify-image-library-permissions/" class="spectrum-SideNav-itemLink ">Modify Image Library folder permissions</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/extension-coding/example-module-adminpage.html" class="spectrum-SideNav-itemLink ">Creating an admin page</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/dynamic-row-system-config.html" class="spectrum-SideNav-itemLink ">Creating a dynamic row system config</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/custom-import-entity.html" class="spectrum-SideNav-itemLink ">Creating a custom import entity</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/custom-widget.html" class="spectrum-SideNav-itemLink ">Creating a custom widget</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/create-access-control-list-rule.html" class="spectrum-SideNav-itemLink ">Creating an Access Control List (ACL) rule</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/create-integration-with-api.html" class="spectrum-SideNav-itemLink ">Creating an integration with an external API</a></li><li class="  spectrum-SideNav-item" role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/ext-best-practices/tutorials/create-custom-rest-api.html" class="spectrum-SideNav-itemLink ">Create a custom REST API</a></li></ul></li></ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<header class="content-header">
				<!-- page-header -->
<section class="page-intro">

  

  
  <div class="message-banner">
    <center>Adobe Commerce 2.3 reached end of support in September 2022.</center>
  </div>
  

  




<!--   

<div class="spectrum-Tags" role="list" aria-label="Tags">
  <div class="spectrum-Tags-item" role="listitem" tabindex="0">
    <img class="spectrum-Avatar" src="img/example-ava.jpg" alt="Avatar">
    <span class="spectrum-Tags-itemLabel">Shantanu</span>
  </div>
</div> -->


  <h1 class="page-title">Serialized to JSON data upgrade</h1>

  

  
	<div class="github-links spectrum-ActionGroup--compact ActionGroup--justified"></div>
	

</section>

			</header>
			<main>
				<h2 id="overview">Overview</h2>

<p>The following tutorial lists the steps needed to create an upgrade script that converts the data stored in the database from the default <a href="https://glossary.magento.com/php">PHP</a> serialized format to JSON format.</p>

<p>Use this tutorial to create an upgrade script to update your <a href="https://glossary.magento.com/extension">extension</a> to work with Magento 2.2 and above.</p>

<h2 id="before-you-begin">Before you begin</h2>

<p>Identify the data you need to convert to JSON in the database.</p>

<p>Your extension <em>must</em> convert data in the following cases:</p>

<ol>
  <li>The extension stores serialized data provided by a core <a href="https://glossary.magento.com/module">module</a> that now uses the JSON format.</li>
  <li>The extension uses the automatic serializing mechanism provided by the Magento framework (i.e. the extension declares <code class="language-plaintext highlighter-rouge">\Magento\Framework\Model\ResourceModel\Db\AbstractDb::$_serializableFields</code>).</li>
</ol>

<p>Your extension will continue working in Magento 2.2 and above in the following cases, but we recommend you switch to using the JSON format for security reasons:</p>

<ol>
  <li>The extension stores its own serialized data.</li>
  <li>The extension is responsible for serializing and unserializing data stored in core tables.</li>
</ol>

<h3 id="api-overview">API Overview</h3>

<p>This tutorial uses the following framework <a href="https://glossary.magento.com/api">API</a> in the following ways:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\FieldDataConverter</code> - This class converts values for a field in a table from one format to another.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\FieldDataConverterFactory</code> - This class creates instances of the <code class="language-plaintext highlighter-rouge">FieldDataConverter</code> with the appropriate data converter implementation.</li>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\AggregatedFieldDataConverter</code> - This is a service class that allows specifying multiple fields from different tables at once. This class creates instances of the <code class="language-plaintext highlighter-rouge">FieldDataConverter</code> class and accepts a list of <code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\FieldToConvert</code> value objects with field information. A single <code class="language-plaintext highlighter-rouge">convert()</code> method call is limited to one DB connection.</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\DataConverter\DataConverterInterface</code> - This interface is for classes that convert data between different formats or types of data.</li>
  <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\FieldDataConverter</code> - This class accepts query modifiers for updating specific rows. Here is API for the query modifiers part:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\Select\QueryModifierInterface</code> - Interface for classes that add a condition to the database query to target specific entries.</li>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\Select\QueryModifierFactory</code> - This class creates instances of specific implementations of <code class="language-plaintext highlighter-rouge">QueryModifierInterface</code>.</li>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\Select\InQueryModifier</code> - An implementation of the <code class="language-plaintext highlighter-rouge">QueryModifierInterface</code> that adds an IN condition to a query.</li>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\Select\LikeQueryModifier</code> - An implementation of the <code class="language-plaintext highlighter-rouge">QueryModifierInterface</code> that adds a LIKE condition to a query.</li>
      <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\Select\CompositeQueryModifier</code> - An implementation of the <code class="language-plaintext highlighter-rouge">QueryModifierInterface</code> that allows the application of multiple query modifiers.</li>
    </ul>
  </li>
</ul>

<p>You can create your own query modifier or use any of the ones listed in the <code class="language-plaintext highlighter-rouge">app/etc/di.xml</code> file.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">\Magento\Framework\Module\Manager</code> - This class checks the status of a module.</li>
</ul>

<h2 id="step-1">Step 1: Create the basic upgrade script</h2>

<p>The upgrade script is what runs during the upgrade step of your extension’s <a href="/devdocs-archive/2.3/guides/v2.3/extension-dev-guide/prepare/lifecycle.html" title="Extension Lifecycle">lifecycle</a>.
Create the <code class="language-plaintext highlighter-rouge">UpgradeData.php</code> file in the <code class="language-plaintext highlighter-rouge">Setup</code> directory inside your extension’s root directory.</p>

<p>Inside the file, create the class <code class="language-plaintext highlighter-rouge">UpgradeData</code> which implements <code class="language-plaintext highlighter-rouge">\Magento\Framework\Setup\UpgradeDataInterface</code>.</p>

<p>Example upgrade script content:</p>

<div class="collapsible">
    <b class="collapsible-title">Show upgrade script content</b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="cd">/**
 * Copyright © Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */</span>

<span class="kn">namespace</span> <span class="nn">Magento\CustomModule\Setup</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Magento\Framework\DB\FieldDataConverterFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\DB\Query\Generator</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\DB\Select\QueryModifierFactory</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\Setup\ModuleContextInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\Setup\ModuleDataSetupInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\Setup\UpgradeDataInterface</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">UpgradeData</span> <span class="kd">implements</span> <span class="nc">UpgradeDataInterface</span>
<span class="p">{</span>
    <span class="cd">/**
     * @var FieldDataConverterFactory
     */</span>
    <span class="k">private</span> <span class="nv">$fieldDataConverterFactory</span><span class="p">;</span>

    <span class="cd">/**
     * @var QueryModifierFactory
     */</span>
    <span class="k">private</span> <span class="nv">$queryModifierFactory</span><span class="p">;</span>

    <span class="cd">/**
     * @var Generator
     */</span>
    <span class="k">private</span> <span class="nv">$queryGenerator</span><span class="p">;</span>

    <span class="cd">/**
     * Constructor
     *
     * @param FieldDataConverterFactory $fieldDataConverterFactory
     * @param QueryModifierFactory $queryModifierFactory
     * @param Generator $queryGenerator
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span>
        <span class="kt">FieldDataConverterFactory</span> <span class="nv">$fieldDataConverterFactory</span><span class="p">,</span>
        <span class="kt">QueryModifierFactory</span> <span class="nv">$queryModifierFactory</span><span class="p">,</span>
        <span class="kt">Generator</span> <span class="nv">$queryGenerator</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fieldDataConverterFactory</span> <span class="o">=</span> <span class="nv">$fieldDataConverterFactory</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">queryModifierFactory</span> <span class="o">=</span> <span class="nv">$queryModifierFactory</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">queryGenerator</span> <span class="o">=</span> <span class="nv">$queryGenerator</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @inheritDoc
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">upgrade</span><span class="p">(</span>
        <span class="kt">ModuleDataSetupInterface</span> <span class="nv">$setup</span><span class="p">,</span>
        <span class="kt">ModuleContextInterface</span> <span class="nv">$context</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="nv">$context</span><span class="o">-&gt;</span><span class="nf">getVersion</span><span class="p">(),</span> <span class="s1">'2.0.1'</span><span class="p">,</span> <span class="s1">'&lt;'</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">convertSerializedDataToJson</span><span class="p">(</span><span class="nv">$setup</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Upgrade to version 2.0.1, convert data for the sales_order_item.product_options and quote_item_option.value
     * from serialized to JSON format
     *
     * @param ModuleDataSetupInterface $setup
     * @return void
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">convertSerializedDataToJson</span><span class="p">(</span><span class="kt">ModuleDataSetupInterface</span> <span class="nv">$setup</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Upgrade logic here</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h2 id="step-2">Step 2: Check that the module exists</h2>

<p>Any module can replace another module in Magento.
If your extension stores data in the tables of another module or it serializes or unserializes data stored in core modules, make sure the module exists and is active before executing the upgrade logic.</p>

<p>Use the <code class="language-plaintext highlighter-rouge">\Magento\Framework\Module\Manager</code> class to check the status of the module your extension depends on.</p>

<p>Add this dependency in the constructor of your upgrade script class:</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">moduleManager</span><span class="o">-&gt;</span><span class="nf">isEnabled</span><span class="p">(</span><span class="s1">'Magento_Sales'</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Upgrade logic goes here</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h2 id="step-3">Step 3: Write the conversion logic</h2>

<p>The <a href="https://glossary.magento.com/conversion">conversion</a> logic in your script depends on how your extension stores the serialized data.</p>

<p>If your extension stores serialized data in different ways, you will need to use different conversion methods.</p>

<h3 id="step-3a">Step 3a: Convert data in a column for all rows</h3>

<p>Use a <code class="language-plaintext highlighter-rouge">FieldDataConverterFactory</code> to create a <code class="language-plaintext highlighter-rouge">FieldDataConverter</code> instance with the appropriate data converter.</p>

<p>Convert data for a column in a table using:</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nv">$fieldDataConverter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fieldDataConverterFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span><span class="nc">SerializedToJson</span><span class="o">::</span><span class="n">class</span><span class="p">);</span>

<span class="nv">$fieldDataConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">(),</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'my_table'</span><span class="p">),</span>
    <span class="s1">'entity_id'</span><span class="p">,</span>
    <span class="s1">'field'</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h3 id="step-3b">Step 3b: Convert data in specific rows for a field</h3>

<table>
  <thead>
    <tr>
      <th>option_id</th>
      <th>code</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td><code class="language-plaintext highlighter-rouge">my_option</code></td>
      <td><code class="language-plaintext highlighter-rouge">a:1:{s:3:"foo";s:3:"bar";}</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td><code class="language-plaintext highlighter-rouge">another_option</code></td>
      <td>&lt;non-serialized string&gt;</td>
    </tr>
    <tr>
      <td>3</td>
      <td><code class="language-plaintext highlighter-rouge">my_option</code></td>
      <td><code class="language-plaintext highlighter-rouge">a:1:{s:3:"foo";s:3:"bar";}</code></td>
    </tr>
  </tbody>
</table>

<p>If you need to convert specific rows in the column, you can use a query modifier to update values using a condition.</p>

<p>The following code sample upgrades the data for options in the <code class="language-plaintext highlighter-rouge">value</code> column in the <code class="language-plaintext highlighter-rouge">quote_item_option</code> table with the code <code class="language-plaintext highlighter-rouge">my_option</code>.</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">Magento\Framework\DB\DataConverter\SerializedToJson</span><span class="p">;</span>

<span class="nv">$fieldDataConverter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fieldDataConverterFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span>
    <span class="nc">SerializedToJson</span><span class="o">::</span><span class="n">class</span>
<span class="p">);</span>

<span class="c1">// Convert data for the option with static name in quote_item_option.value</span>
<span class="nv">$queryModifier</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">queryModifierFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span>
    <span class="s1">'in'</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s1">'values'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">'my_option'</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">);</span>
<span class="nv">$fieldDataConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">(),</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'quote_item_option'</span><span class="p">),</span>
    <span class="s1">'option_id'</span><span class="p">,</span>
    <span class="s1">'value'</span><span class="p">,</span>
    <span class="nv">$queryModifier</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h4 id="use-values-from-another-table-in-the-condition">Use values from another table in the condition</h4>

<p>The following tables show how the <code class="language-plaintext highlighter-rouge">type</code> and <code class="language-plaintext highlighter-rouge">option_id</code> columns from the <code class="language-plaintext highlighter-rouge">catalog_product_option</code> table form the unique <code class="language-plaintext highlighter-rouge">code</code> value for custom options in the <code class="language-plaintext highlighter-rouge">quote_item_option</code> table.</p>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">catalog_product_option</code> table</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>option_id</th>
      <th>product_id</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1001</td>
      <td>1</td>
      <td>my_custom_option</td>
    </tr>
    <tr>
      <td>1002</td>
      <td>2</td>
      <td>my_custom_option</td>
    </tr>
    <tr>
      <td>1003</td>
      <td>5</td>
      <td>my_custom_option</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">quote_item_option</code> table</p>
</blockquote>

<table>
  <thead>
    <tr>
      <th>option_id</th>
      <th>code</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>my_custom_option_1001</td>
      <td><code class="language-plaintext highlighter-rouge">a:1:{s:3:"foo";s:3:"bar";}</code></td>
    </tr>
    <tr>
      <td>2</td>
      <td>another_option</td>
      <td>&lt;non-serialized string&gt;</td>
    </tr>
    <tr>
      <td>3</td>
      <td>my_custom_option_1002</td>
      <td><code class="language-plaintext highlighter-rouge">a:1:{s:3:"foo";s:3:"bar";}</code></td>
    </tr>
    <tr>
      <td>4</td>
      <td>my_custom_option_1003</td>
      <td><code class="language-plaintext highlighter-rouge">a:1:{s:3:"foo";s:3:"bar";}</code></td>
    </tr>
  </tbody>
</table>

<p>To update custom options data in the <code class="language-plaintext highlighter-rouge">quote_item_option</code> table:</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">Magento\Framework\DB\DataConverter\SerializedToJson</span><span class="p">;</span>

<span class="nv">$fieldDataConverter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fieldDataConverterFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span>
    <span class="nc">SerializedToJson</span><span class="o">::</span><span class="n">class</span>
<span class="p">);</span>
<span class="c1">// Convert data for the option with dynamic name in quote_item_option.value</span>
<span class="nv">$select</span> <span class="o">=</span> <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">select</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="nf">from</span><span class="p">(</span>
        <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'catalog_product_option'</span><span class="p">),</span>
        <span class="p">[</span><span class="s1">'option_id'</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="o">-&gt;</span><span class="nf">where</span><span class="p">(</span><span class="s1">'type = ?'</span><span class="p">,</span> <span class="s1">'my_custom_option'</span><span class="p">);</span>
<span class="nv">$iterator</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">queryGenerator</span><span class="o">-&gt;</span><span class="nf">generate</span><span class="p">(</span><span class="s1">'option_id'</span><span class="p">,</span> <span class="nv">$select</span><span class="p">);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$iterator</span> <span class="k">as</span> <span class="nv">$selectByRange</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$codes</span> <span class="o">=</span> <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">fetchCol</span><span class="p">(</span><span class="nv">$selectByRange</span><span class="p">);</span>
    <span class="nv">$codes</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span>
        <span class="k">function</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s1">'my_custom_option_'</span> <span class="mf">.</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="p">},</span>
        <span class="nv">$codes</span>
    <span class="p">);</span>
    <span class="nv">$queryModifier</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">queryModifierFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span>
        <span class="s1">'in'</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="s1">'values'</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">'code'</span> <span class="o">=&gt;</span> <span class="nv">$codes</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">);</span>
    <span class="nv">$fieldDataConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span>
        <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">(),</span>
        <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'quote_item_option'</span><span class="p">),</span>
        <span class="s1">'option_id'</span><span class="p">,</span>
        <span class="s1">'value'</span><span class="p">,</span>
        <span class="nv">$queryModifier</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h3 id="step-3c">Step 3c: Convert nested serialized data</h3>

<p>If your module uses nested serialized data in the database, create a custom data converter to hold the logic for converting the data.</p>

<p>The following example is a custom data converter class that converts data in the <code class="language-plaintext highlighter-rouge">product_options</code> column in the <code class="language-plaintext highlighter-rouge">sales_order_item</code> table.
This field contains nested serialized data that needs conversion.</p>

<p>Since you cannot assume the format of the data when initially converted, the following example also checks the format and uses the appropriate methods to unserialize and serialize the data using the original format.</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="cd">/**
 * Copyright © Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */</span>

<span class="kn">namespace</span> <span class="nn">Magento\CustomModule\Setup</span><span class="p">;</span>

<span class="kn">use</span> <span class="nc">Magento\Framework\DB\DataConverter\DataConverterInterface</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\Serialize\Serializer\Json</span><span class="p">;</span>
<span class="kn">use</span> <span class="nc">Magento\Framework\Serialize\Serializer\Serialize</span><span class="p">;</span>

<span class="cd">/**
 * Serializer used to convert data in product_options field
 */</span>
<span class="kd">class</span> <span class="nc">SerializedToJsonDataConverter</span> <span class="kd">implements</span> <span class="nc">DataConverterInterface</span>
<span class="p">{</span>
    <span class="cd">/**
     * @var Serialize
     */</span>
    <span class="k">private</span> <span class="nv">$serialize</span><span class="p">;</span>

    <span class="cd">/**
     * @var Json
     */</span>
    <span class="k">private</span> <span class="nv">$json</span><span class="p">;</span>

    <span class="cd">/**
     * Constructor
     *
     * @param Serialize $serialize
     * @param Json $json
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span>
        <span class="kt">Serialize</span> <span class="nv">$serialize</span><span class="p">,</span>
        <span class="kt">Json</span> <span class="nv">$json</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">serialize</span> <span class="o">=</span> <span class="nv">$serialize</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">json</span> <span class="o">=</span> <span class="nv">$json</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Convert from serialized to JSON format
     *
     * @param string $value
     * @return string
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">convert</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$isSerialized</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">isSerialized</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
        <span class="nv">$unserialized</span> <span class="o">=</span> <span class="nv">$isSerialized</span>
          <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">serialize</span><span class="o">-&gt;</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
          <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">json</span><span class="o">-&gt;</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$value</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'options'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'options'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$option</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nv">$option</span><span class="p">[</span><span class="s1">'option_type'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'my_custom_option'</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'options'</span><span class="p">][</span><span class="nv">$key</span><span class="p">][</span><span class="s1">'option_value'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">json</span><span class="o">-&gt;</span><span class="nb">serialize</span><span class="p">(</span>
                        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">serialize</span><span class="o">-&gt;</span><span class="nb">unserialize</span><span class="p">(</span>
                            <span class="nv">$option</span><span class="p">[</span><span class="s1">'option_value'</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'my_option'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'my_option'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">json</span><span class="o">-&gt;</span><span class="nb">serialize</span><span class="p">(</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">serialize</span><span class="o">-&gt;</span><span class="nb">unserialize</span><span class="p">(</span>
                    <span class="nv">$unserialized</span><span class="p">[</span><span class="s1">'my_option'</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$isSerialized</span>
          <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">serialize</span><span class="o">-&gt;</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$unserialized</span><span class="p">)</span>
          <span class="o">:</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">json</span><span class="o">-&gt;</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$unserialized</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="cd">/**
     * Check if value is serialized string
     *
     * @param string $value
     * @return boolean
     */</span>
    <span class="k">private</span> <span class="k">function</span> <span class="n">isSerialized</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">boolean</span><span class="p">)</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'/^((s|i|d|b|a|O|C):|N;)/'</span><span class="p">,</span> <span class="nv">$value</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<p>After creating your custom data converter class, use the <code class="language-plaintext highlighter-rouge">FieldDataConverterFactory</code> to create a <code class="language-plaintext highlighter-rouge">FieldDataConverter</code> instance with your custom converter:</p>

<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">Magento\CustomModule\Setup\SerializedToJsonDataConverter</span><span class="p">;</span>

<span class="c1">// Convert options in sales_order_item.product_options</span>
<span class="nv">$fieldDataConverter</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">fieldDataConverterFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">(</span>
    <span class="nc">SerializedToJsonDataConverter</span><span class="o">::</span><span class="n">class</span>
<span class="p">);</span>
<span class="nv">$fieldDataConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">(),</span>
    <span class="nv">$setup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'sales_order_item'</span><span class="p">),</span>
    <span class="s1">'item_id'</span><span class="p">,</span>
    <span class="s1">'product_options'</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h3 id="step-3d">Step 3d: Convert data in a multi-database setup</h3>

<p>Adobe Commerce supports storing Quote, Sales, and Inventory data in separate databases.
Use the specific connections for each of these modules to update your extension’s stored data for the entities of these modules.</p>

<p>The following code sample obtains the Sales module connection and uses it during data update.</p>
<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">Magento\Sales\Setup\SalesSetupFactory</span><span class="p">;</span>

<span class="cd">/** SalesSetupFactory $salesSetup */</span>
<span class="nv">$salesSetup</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">salesSetupFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">([</span><span class="s1">'setup'</span> <span class="o">=&gt;</span> <span class="nv">$setup</span><span class="p">]);</span>

<span class="nv">$fieldDataConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span>
    <span class="nv">$salesSetup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">(),</span>
    <span class="nv">$salesSetup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'sales_order_item'</span><span class="p">),</span>
    <span class="s1">'item_id'</span><span class="p">,</span>
    <span class="s1">'product_options'</span>
<span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h3 id="step-3e-convert-data-from-multiple-fields">Step 3e: Convert data from multiple fields</h3>

<p>Use the <code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\AggregatedFieldDataConverter</code> class to update multiple files instead of <code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\FieldDataConverter</code>.</p>

<p>The following code sample updates two fields in different tables taking into account setup version of the module.
It is possible to aggregate fields for the same connection only. If it is necessary to use multiple connections in one setup script, multiple calls to <code class="language-plaintext highlighter-rouge">\Magento\Framework\DB\AggregatedFieldDataConverter::convert()</code> must be made.</p>
<div class="collapsible">
    <b class="collapsible-title">Show code </b>
    <div class="collapsible-content"><div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="kn">use</span> <span class="nc">Magento\Sales\Setup\SalesSetupFactory</span><span class="p">;</span>

<span class="cd">/** SalesSetupFactory $salesSetup */</span>
<span class="nv">$salesSetup</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">salesSetupFactory</span><span class="o">-&gt;</span><span class="nf">create</span><span class="p">([</span><span class="s1">'setup'</span> <span class="o">=&gt;</span> <span class="nv">$setup</span><span class="p">]);</span>

<span class="nv">$fieldsToUpdate</span> <span class="o">=</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nc">FieldToConvert</span><span class="p">(</span>
        <span class="nc">SerializedToJson</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="nv">$salesSetup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'sales_invoice_item'</span><span class="p">),</span>
        <span class="s1">'entity_id'</span><span class="p">,</span>
        <span class="s1">'tax_ratio'</span>
    <span class="p">),</span>
<span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">version_compare</span><span class="p">(</span><span class="nv">$setupVersion</span><span class="p">,</span> <span class="s1">'2.0.5'</span><span class="p">,</span> <span class="s1">'&lt;'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$fieldsToUpdate</span><span class="p">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FieldToConvert</span><span class="p">(</span>
        <span class="nc">SerializedDataConverter</span><span class="o">::</span><span class="n">class</span><span class="p">,</span>
        <span class="nv">$salesSetup</span><span class="o">-&gt;</span><span class="nf">getTable</span><span class="p">(</span><span class="s1">'sales_order_item'</span><span class="p">),</span>
        <span class="s1">'item_id'</span><span class="p">,</span>
        <span class="s1">'product_options'</span>
    <span class="p">);</span>
<span class="p">}</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">aggregatedFieldConverter</span><span class="o">-&gt;</span><span class="nf">convert</span><span class="p">(</span><span class="nv">$fieldsToUpdate</span><span class="p">,</span> <span class="nv">$salesSetup</span><span class="o">-&gt;</span><span class="nf">getConnection</span><span class="p">());</span>
</pre></td></tr></tbody></table></code></pre></div></div>
</div>
  </div>

<h2 id="related-topics">Related Topics</h2>

<ul>
  <li><a href="/devdocs-archive/2.3/guides/v2.3/extension-dev-guide/framework/serializer.html" title="Serialize Library">Serialize Library</a></li>
  <li><a href="/devdocs-archive/2.3/guides/v2.3/extension-dev-guide/prepare/lifecycle.html" title="Extension Lifecycle">Extension Lifecycle</a></li>
</ul>


			</main>
			<footer class="content-footer">
				<button class="page-updated spectrum-ActionButton spectrum-ActionButton--sizeM spectrum-ActionButton--quiet">
  <img class="spectrum-Icon spectrum-Icon--sizeS" src="/devdocs-archive/2.3/assets/i/icons/time.svg" alt="Updated" />
  <time class="spectrum-ActionButton-label" id="last-modified-at" itemprop="dateModified"
    datetime="2022-10-01">
    Oct 1st, 2022
  </time>
</button>

			</footer>
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->

</div>
<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
    <div class="container">
  
      <div class="copyright-links">
        

<ul class="nav footer-links" role="menu">

  <li class="  " role="menuitem"><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md" class=" ">Become a Contributor</a></li>

  <li class="  " role="menuitem"><a href="https://glossary.magento.com/" class=" ">Glossary</a></li>

  <li class="  " role="menuitem"><a href="https://magento.com/legal/terms/privacy/" class=" ">Privacy Policy</a></li>

  <li class="  " role="menuitem"><a href="https://magento.com/legal/terms/" class=" ">Terms of Service</a></li>

  <li class="  " role="menuitem"><a href="https://magento.com/legal/licensing/" class=" ">License/Trademark FAQ</a></li>

  <li class="  " role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/release-notes/bk-release-notes.html" class=" ">Release Notes</a></li>

  <li class="  " role="menuitem"><a href="/devdocs-archive/2.3/guides/v2.3/release-notes/packages-open-source.html" class=" ">Third-Party Licenses</a></li>

</ul>

      </div>
  
          <div class="copyright-date">&copy; 2023 Adobe. All rights reserved.</div>
  
    </div>
  </div>
  <!-- / #footer -->
  
  


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs-archive/2.3/assets/js/app.min.js?ver=20"></script>
<script src="/devdocs-archive/2.3/assets/js/editions.min.js?ver=20"></script>
<script src="/devdocs-archive/2.3/assets/js/page-updated.min.js?ver=20"></script>





<script type="text/javascript" src="/devdocs-archive/2.3/common/js/glossary-link-enhancer.js"></script>


</body>

</html>
