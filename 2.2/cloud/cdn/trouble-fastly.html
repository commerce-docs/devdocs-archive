<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Fastly troubleshooting | Archived Magento 2.2 Developer Documentation</title>
	<meta name="description" content="Archived Magento 2 Developer Documentation.">

	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/app.css?ver=7" />
	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/print.css?ver=7" media="print"/>

	<link rel="stylesheet" href="/devdocs-archive/2.2/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />



<meta name="google-site-verification" content="3WFsoYwBe6UuxDwgs7bmd7t0YFQVzDpLpWLjNh0CUp8" />

	<script>
  var baseUrl = "/devdocs-archive/2.2";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c",
  };

  var indices = [
    {
      label: "DevDocs",
      name: "devdocs",
      facetFilters: [["guide_version: 2.2", "versionless: true"]],
      refinements: [
        {
          label: "Functional areas",
          attribute: "functional_areas"
        }
      ],
      baseUrl: "https://devdocs.magento.com"
    },
    {
      label: "User Guide",
      name: "merchdocs_ee",
      baseUrl: "https://docs.magento.com/m2/ee/user_guide"
    },
    {
      label: "MBI User Guide",
      name: "merchdocs-mbi",
      baseUrl: "https://docs.magento.com/mbi"
    },
    {
      label: "Marketplace User Guide",
      name: "merchdocs-marketplace",
      baseUrl: "https://docs.magento.com/marketplace/user_guide"
    },
    {
      label: "PWA",
      name: "pwa-devdocs",
      baseUrl: "https://magento.github.io/pwa-studio"
    },
    {
      label: "Order Management",
      name: "oms-en",
      baseUrl: "https://omsdocs.magento.com"
    }
  ];
</script>




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">


	<header class="site-header">
		

<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" href="/devdocs-archive/2.2/">
      <img src="/devdocs-archive/2.2/assets/i/m-logo.svg" alt=""><img src="/devdocs-archive/2.2/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      



      <!-- Main Navigation --><ul class="nav-main" role="menubar"><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Cloud basics</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/bk-cloud.html">Cloud Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/cloud-architecture.html">Cloud Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/release-notes/cloud-tools.html">Release Notes</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Cloud development</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup.html">Local development</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments.html">Configure Environments</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/extensions/">Magento Extensions Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Software Update Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/performance-best-practices/introduction.html">Performance Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Information</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/reference/cli/magento.html">Command-line Tools Reference</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/architecture/bk-architecture.html">Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/marketplace/eqp/v1/api.html">Marketplace EQP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mbi/docs/getting-started.html">Business Intelligence API</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/testing.html">Magento Testing Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mftf/docs/introduction.html">Functional Acceptance Testing (MFTF)</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li></ul></div></li><li class="nav-main-separator"></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/b2b/bk-b2b.html">B2B</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/compliance/industry-compliance.html">Compliance</a></li><li class="" role="menuitem"><a href="http://omsdocs.magento.com/en/">Order Management</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/tutorials/index.html">Rest Tutorials</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/customize_product.html">Customize Product Creation Form</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Customize Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/community/resources/support.html">Magento Support</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/videos/">Video Tutorials</a></li></ul></div></li></ul><!-- /.nav-main -->

    </div>

    <div class="nav-actions">
      
<div class="app-switcher">
  <div class="dropdown">
    <button id="app-switcher-trigger" class="app-switcher-trigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Documentation sites"></button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="app-switcher-trigger" role="menu">
      <div class="app-switcher-content">
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Developer</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://devdocs.magento.com/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce Developer Documentation">Commerce Developer Documentation</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="http://pwastudio.io/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=PWA Studio">PWA Studio</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
      </div>
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Merchant</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/m2/ee/user_guide/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce User Guide">Commerce User Guide</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/userguides/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/mbi/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Business Intelligence">Business Intelligence</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/marketplace/user_guide/getting-started.html?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Marketplace">Marketplace</a></li>
        
      </div>
      
      </div>
    </ul>
  </div>
</div>

    </div>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>

	</header>

	<div class="global-wrapper">
		
		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<button class="toc-toggler">Table of Contents</button>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Magento Commerce Cloud</h4>
		<div class="collapsible-navigation">
		    <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/bk-cloud.html">Overview</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/onboarding/onboarding-tasks.html">Onboarding tasks</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/cloud-architecture.html">Architecture</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/basic-information/starter-architecture.html">Starter architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/basic-information/starter-develop-deploy-workflow.html">Starter develop and deploy workflow</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/pro-architecture.html">Pro architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/pro-develop-deploy-workflow.html">Pro develop and deploy workflow</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/scaled-architecture.html">Scaled architecture</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/requirements/cloud-requirements.html">Technologies and requirements</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/cloud-composer.html">Composer</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/cli-ref-topic.html">Magento Cloud CLI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/ece-tools-reference.html">ece-tools package</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/git-integration.html">Git</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments-ssh.html">SSH and sFTP</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/new-relic.html">New Relic</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-integrate-blackfire.html">Blackfire.io</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/sendgrid.html">SendGrid</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup.html">Local development setup</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace.html">Prepare for manual setup</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-magento-prereqs.html">Install Magento prerequisites</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-ssh.html">Enable SSH keys</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-file-sys-owner.html">Set up the Magento file system owner</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-setup-env-2_clone.html">Clone and branch the project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-setup-env-install.html">Install Magento</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-deploy.html">First time deployment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/debug.html">Optional - Configure Xdebug</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/sample-data.html">Optional - Install sample data</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development.html">Docker development</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development-debug.html">Configure Xdebug for Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-database.html">Connect to the database</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development-testing.html">Functional testing in Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/cloud-integrations.html">Integrations</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/bitbucket-integration.html">Bitbucket integration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/github-integration.html">GitHub integration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/health-notifications.html">Health notifications</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-first-steps.html">Import existing code into a project</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-prepare.html">Prepare your existing Magento Commerce system</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-import.html">Import Magento Commerce code</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/configuration-overview.html">Configure your store</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/configure-best-practices.html">Best practices for store configuration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/paypal-onboarding.html">Set up PayPal</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/setup-b2b.html">Set up Magento B2B</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/setup-cron-jobs.html">Set up cron jobs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-multi-sites.html">Set up multiple Cloud websites or stores</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/install-components.html">Install, manage, and upgrade modules</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/custom-theme.html">Install a theme</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/import-url-rewrites.html">Import URL Rewrites</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html">Configure Fastly services</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html">Set up Fastly</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly-custom-response.html">Customize error and maintenance pages</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-waf-service.html">Web Application Firewall</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-image-optimization.html">Image Optimization</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-vcl-custom-snippets.html">Custom VCL snippets</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-wordpress.html">Reroute requests to a CMS backend</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-badreferer.html">Block referral spam</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-whitelist.html">Secure access to the Magento Admin UI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-blocking.html">Custom VCL for blocking</a></li></ul></li><li class="active" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/trouble-fastly.html">Fastly troubleshooting</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments.html">Configure environments</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_magento-app.html">Application</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/set-cache.html">Set cache for static files</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/magento-env-yaml.html">Build and deploy</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/setup-notifications.html">Set up notifications</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/log-handlers.html">Logging handlers</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-intro.html">Environment variables</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environment-vars_magento.html">ADMIN variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-global.html">Global variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-build.html">Build variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-cloud.html">Cloud variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-deploy.html">Deploy variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-post-deploy.html">Post-deploy variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/working-with-variables.html">Working with variables</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_routes.html">Routes</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-cache.html">Caching</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-redir.html">Redirects</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-ssi.html">Server side includes</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services.html">Services</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-mysql.html">Set up MySQL service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-redis.html">Set up Redis service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-elastic.html">Set up Elasticsearch service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-rabbit.html">Set up RabbitMQ service</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/restore-environment.html">Restore an environment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/sens-data-over.html">Configuration management for store settings</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/sens-data-initial.html">Example of managing system-specific settings</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/projects.html">Manage your project</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-basic.html">Configure your project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-start.html">Project structure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/log-locations.html">Log locations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/user-admin.html">Create and manage users</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-branch.html">Manage branches with the Interface</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments-start.html">Manage branches with the CLI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/profile-database-queries.html">Profile database queries</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/manage-disk-space.html">Manage disk space</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/monitor-performance.html">Monitor performance</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-snap.html">Snapshots and backup management</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/optimize-cloud-deployment.html">Optimize deployment</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/cloud-deployment-process.html">Cloud deployment process</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/reduce-downtime.html">Zero downtime deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/static-content-deployment.html">Static content deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/smart-wizards.html">Smart wizards</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-live.html">Deploy your store</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/discover-deploy.html">Deployment process</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/continuous-deployment.html">Continuous deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live-prot.html">Protective block</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live-sanity-check.html">Build and deploy on local</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-migrate-prereq.html">Prepare to deploy to Staging and Production</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-migrate.html">Deploy code and migrate static files and data</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-test.html">Test deployment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live.html">Go live and launch</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/go-live-checklist.html">Go live checklist</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/launch-steps.html">Launch steps</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble.html">Troubleshooting</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/troubleshoot-deployment.html">Troubleshoot deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_ce-creds.html">Incorrect credentials</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_proj-startover.html">Resolve issues with a new project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_comp-deploy-fail.html">Component deployment failure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/reset-cron-jobs.html">Reset cron jobs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-crypt-key-variable.html">Resolve issues with encryption key</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-error-html-minification.html">Resolve issues with HTML minification</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-google-analytics-deploy.html">Resolve issues with Google Analytics during deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/restore-configuration-files.html">Restore configuration files</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/site-availability.html">Site availability</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/robots-sitemap.html">Add site map and search engine robots</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/theme-troubleshooting.html">Theme troubleshooting</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade-parent.html">Upgrades and patches</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/ece-tools-upgrade-project.html">Upgrade to use ece-tools</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/ece-tools-update.html">Update ece-tools version</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-patch.html">Apply custom patches</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade.html">Upgrade Magento version</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/release-notes/cloud-tools.html">Release notes</a></li></ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">








<h1 class="page-heading">Fastly troubleshooting</h1>
</section>

			<p>Use the following information to troubleshoot and manage the Fastly CDN module for Magento 2 in your Magento Commerce Cloud project environments. For example, you can investigate response header values and caching behavior to resolve Fastly service and performance issues.</p>

<p class="bs-callout-info">For information about setting up and configuring Fastly, see <a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html">Set up Fastly</a>.</p>

<h2 id="service-id">Locate Fastly service ID</h2>

<p>You need the Fastly service ID to configure Fastly from the Magento Admin UI or to submit Fastly API requests for advanced Fastly configuration and troubleshooting.</p>

<p>If Fastly is enabled in your project environment, you can get the service ID from the Magento Admin UI. See <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#cloud-fastly-creds">Get Fastly credentials</a>.</p>

<p>Developers and advanced VCL users can use custom VCL to retrieve the service ID using the Fastly variable <code class="language-plaintext highlighter-rouge">req.service_id</code>. For example, you can add the <code class="language-plaintext highlighter-rouge">req.service_id</code> to the custom logging directive in your VCL to capture the service ID value:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="err">log</span><span class="w"> </span><span class="p">{</span><span class="s2">"syslog"</span><span class="p">}</span><span class="w"> </span><span class="err">req.service_id</span><span class="w"> </span><span class="p">{</span><span class="s2">" my_logging_endpoint_name :: "</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>You can use the same VCL for Production and Staging environments. See <a href="https://support.fastly.com/hc/en-us/community/posts/360040447172-How-to-configure-vcl-log">How to configure vcl_log</a>.</p>

<h2 id="troubleshoot-site-performance-purge-and-cache-issues">Troubleshoot site performance, purge, and cache issues</h2>

<p>Use the following list to identify and troubleshoot issues related to the Fastly service configuration for your Magento Commerce Cloud environment.</p>

<ul>
  <li>
    <p><strong>Store menu does not display or work</strong>—You might be using a link or temp link directly to the origin server instead of using the live site URL, or you used <code class="language-plaintext highlighter-rouge">-H "host:URL"</code> in a <a href="#curl">cURL command</a>. If you bypass Fastly to the origin server, the main menu does not work and incorrect headers display that allow caching on the browser side.</p>
  </li>
  <li>
    <p><strong>Top level navigation does not work</strong>—The top level navigation relies on Edge Side Includes (ESI) processing which is enabled when you upload the default Magento Fastly VCL snippets. If the navigation is not working, <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#upload-vcl-snippets">upload the Fastly VCL</a> and recheck the site.</p>
  </li>
  <li>
    <p><strong>Geo-location/GeoIP does not work</strong>— The default Magento Fastly VCL snippets append the country code to the URL. If the country code is not working, <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#upload-vcl-snippets">upload the Fastly VCL</a> and recheck the site.</p>
  </li>
  <li>
    <p><strong>Pages are not caching</strong>—By default, Fastly does not cache pages with the <code class="language-plaintext highlighter-rouge">Set-Cookies</code> header. Magento sets cookies even on cacheable pages (TTL &gt; 0). The default Magento Fastly VCL strips those cookies on cacheable pages. If pages are not caching, <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#upload-vcl-snippets">upload the Fastly VCL</a> and recheck the site.</p>

    <p>This issue can also occur if a page block in a template is marked uncacheable. In that case, the problem is most likely caused by a third-party module or Magento extension blocking or removing the Magento headers. To resolve the issue, see <a href="#xcache-miss">X-Cache contains only MISS, no HIT</a>.</p>
  </li>
  <li>
    <p><strong>Purge requests are failing</strong>—Fastly returns the following error when you submit a purge request:</p>

    <p><code class="language-plaintext highlighter-rouge">The purge request was not processed successfully.</code></p>

    <p>This issue can be caused by either of the following issues:</p>

    <ul>
      <li>Invalid Fastly credentials in the Fastly service configuration for the Magento Commerce Cloud project environment</li>
      <li>Invalid code in a custom VCL snippet</li>
    </ul>

    <p>To resolve the issue, see <a href="https://support.magento.com/hc/en-us/articles/115001853194-Error-purging-Fastly-cache-on-Cloud-The-purge-request-was-not-processed-successfully-">Error purging Fastly cache on Cloud</a> in the Magento Help Center.</p>
  </li>
</ul>

<h2 id="errors">503 errors from Fastly</h2>

<p>If Fastly returns 503 timeout errors, check the error logs and the 503 error page to identify the root cause.</p>

<p class="bs-callout-info">If the timeout occurs when running bulk operations, you can <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#bulkaction">extend the Fastly timeout for the Magento Admin UI</a>.</p>

<p>If you receive a 503 error, check the Production or Staging environment error log and php access log to troubleshoot the issue.</p>

<p class="procedure">To check the error logs:</p>

<ul>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/project/log-locations.html#application-logs">Error log</a></p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>/var/log/platform/&lt;project_ID&gt;/error.log
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>This log includes any errors from the application or PHP engine, for example <code class="language-plaintext highlighter-rouge">memory_limit</code> or <code class="language-plaintext highlighter-rouge">max_execution_time exceeded</code> errors. If you do not find any Fastly-related errors, check the PHP access log.</p>
  </li>
  <li>
    <p>PHP access log</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>/var/log/platform/&lt;project_ID&gt;/php.access.log
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>Search the log for HTTP 200 responses for the URL that returned the 503 error. If you find the 200 response, it means that Magento returned the page without errors. That indicates the issue might have occurred after the interval that exceeds the <code class="language-plaintext highlighter-rouge">first_byte_timeout</code> value set in the Fastly service configuration.</p>
  </li>
</ul>

<p>When a 503 error occurs, Fastly returns the reason on the error and maintenance page. You might not be able to see the reason if you added code for a custom response page. To view the reason code on the default error page, you can remove the HTML code for the custom error page.</p>

<p class="procedure">To check the Fastly 503 error page:</p>

<ol>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/onboarding/onboarding-tasks.html#admin">Log in</a> to the Magento Admin UI.</p>
  </li>
  <li>
    <p>Click <strong>Stores</strong> &gt; <strong>Settings</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong>.</p>
  </li>
  <li>
    <p>In the right pane, expand <strong>Full Page Cache</strong>.</p>
  </li>
  <li>
    <p>In the <strong>Fastly Configuration</strong> section, expand <strong>Custom Synthetic Pages</strong> as the following figure shows.</p>

    <p><img width="650px" src="/devdocs-archive/2.2/common/images/cloud/cloud-fastly-custom-synthetic-pages-edit-html.png" alt="Custom 503 error page" /></p>
  </li>
  <li>
    <p>Click <strong>Set HTML</strong>.</p>
  </li>
  <li>
    <p>Remove the custom code. You can save it in a text program to add back later.</p>
  </li>
  <li>
    <p>Click <strong>Upload</strong> to send your updates to Fastly.</p>
  </li>
  <li>
    <p>Click <strong>Save Config</strong> at the top of the page.</p>
  </li>
  <li>
    <p>Reopen the URL that caused the 503 error. Fastly returns an error page with the reason as shown in the following example.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud_fastly-503-example.png" alt="Fastly error" /></p>
  </li>
</ol>

<h2 id="domains">Apex and subdomains already associated with a Fastly account</h2>

<p>If the apex domain and subdomains for your Magento Commerce Cloud project are already associated with an existing Fastly account with an assigned Service ID, you cannot launch until you update your Fastly configuration:</p>

<ul>
  <li>
    <p>Update the apex and subdomain configuration on the existing Fastly account. See <a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html#domain">Multiple Fastly accounts and assigned domains</a>.</p>
  </li>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#cloud-fastly-config">Enable and configure Fastly</a> and complete the <a href="/devdocs-archive/2.2/cloud/live/go-live-checklist.html#dns">DNS configuration</a> for your project environment.</p>
  </li>
</ul>

<h2 id="verify-or-debug-fastly-services">Verify or debug Fastly services</h2>

<p>You can troubleshoot performance or caching issues for a Magento Commerce Cloud site by testing site URLs and examining the header values returned in the response.</p>

<h3 id="curl-live">Check live site through Fastly</h3>

<p>Use the Fastly API to check the following response headers returned from your live site: <code class="language-plaintext highlighter-rouge">Fastly-Magento-VCL-Uploaded</code> and <code class="language-plaintext highlighter-rouge">X-Cache</code>.</p>

<p>Fastly API requests are passed through the Fastly extension to get a response from your origin servers. If the response returns incorrect headers, test the <a href="#cloud-test-stage">origin servers directly</a>.</p>

<p class="procedure">To check the response headers:</p>

<ol>
  <li>
    <p>In a terminal, use the following <code class="language-plaintext highlighter-rouge">curl</code> command to test your live site URL:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl https://&lt;live URL&gt; <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>If you have not set a static route or completed the DNS configuration for the domains on your live site, use the <code class="language-plaintext highlighter-rouge">--resolve</code> flag, which bypasses DNS name resolution.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl https://&lt;live URL&gt; <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1 <span class="o">[</span><span class="nt">--resolve</span><span class="o">]</span> &lt;live URL <span class="nb">hostname</span><span class="o">&gt;</span>:443:&lt;live IP address&gt;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>In the response, verify the <a href="#response-headers">headers</a> to ensure that Fastly is working. You should see following unique headers in the response:</p>

    <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="err">&lt; Fastly-Magento-VCL-Uploaded: yes
&lt; X-Cache: HIT, MISS
</span></pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<p>If the headers do not have the correct values, see the following information:</p>

<ul>
  <li>
    <p><a href="#no-VCL">Check VCL upload</a></p>
  </li>
  <li>
    <p><a href="#xcache-miss">X-Cache contains only MISS, no HIT</a></p>
  </li>
</ul>

<h3 id="cloud-test-stage">Bypass Fastly to check Staging and Production sites</h3>

<p>If the Fastly service returns incorrect headers, submit a Fastly API request directly to the origin server, bypassing the Fastly CDN service.</p>

<p class="procedure">To check the response headers:</p>

<ol>
  <li>
    <p>To get the response data, submit an API request the origin server:</p>

    <ul>
      <li>
        <p><strong>Staging</strong></p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl http[s]://staging.&lt;your domain&gt;.c.&lt;project ID&gt;.ent.magento.cloud <span class="nt">-H</span> <span class="s2">"Host:&lt;URL&gt;"</span> <span class="nt">-k</span> <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
      <li>
        <p><strong>Production</strong></p>

        <p>Submit the following request to test the load balancer:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl http[s]://&lt;your domain&gt;.c.&lt;project ID&gt;.ent.magento.cloud <span class="nt">-H</span> <span class="s2">"Host:&lt;URL&gt;"</span> <span class="nt">-k</span> <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>        </div>

        <p>Submit the following request to test a direct Origin node:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl http[s]:&lt;your domain&gt;.<span class="o">{</span>1|2|3<span class="o">}</span>.&lt;project ID&gt;.ent.magento.cloud <span class="nt">-H</span> <span class="s2">"Host:&lt;URL&gt;"</span> <span class="nt">-k</span> <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>        </div>

        <p>For example, if you have a public URL www.mymagento.biz, enter a command similar to the following to test the production site:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-k</span> https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud <span class="nt">-H</span> <span class="s1">'Host: www.mymagento.biz'</span> <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>        </div>

        <p>If you have not completed the DNS configuration for the public hostname, remove the <code class="language-plaintext highlighter-rouge">"Host:&lt;URL&gt;"</code> option as shown in the following example:</p>

        <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-k</span> https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud <span class="nt">-vo</span> /dev/null <span class="nt">-H</span> Fastly-Debug:1
</pre></td></tr></tbody></table></code></pre></div>        </div>
      </li>
    </ul>
  </li>
  <li>
    <p>In the response, check for errors in the <a href="#response-headers">cache HIT and MISS headers</a>.</p>
  </li>
</ol>

<h3 id="response-headers">Check cache HIT and MISS response headers</h3>

<p>Verify that the returned response contains the following information:</p>

<ul>
  <li>
    <p>Includes the <code class="language-plaintext highlighter-rouge">X-Magento-Tags</code> header</p>
  </li>
  <li>
    <p>The value of the <code class="language-plaintext highlighter-rouge">Fastly-Module-Enabled</code> header is either <code class="language-plaintext highlighter-rouge">Yes</code> or the version number of the Fastly for CDN Magento 2 module installed in the project environment</p>
  </li>
  <li>
    <p><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.9">Cache-Control: max-age</a> is greater than 0</p>
  </li>
  <li>
    <p><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.32">Pragma</a> setting is <code class="language-plaintext highlighter-rouge">cache</code></p>
  </li>
</ul>

<p>The following excerpt from the cURL command output shows the correct values for the <code class="language-plaintext highlighter-rouge">Pragma</code>, <code class="language-plaintext highlighter-rouge">X-Magento-Tags</code>, and <code class="language-plaintext highlighter-rouge">Fastly-Module-Enabled</code> headers:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="go">
</span><span class="gp">* STATE: INIT =&gt;</span><span class="w"> </span>CONNECT handle 0x600057800<span class="p">;</span> line 1402 <span class="o">(</span>connection <span class="c">#-5000)</span>
<span class="go">* Rebuilt URL to: https://www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud/
* Added connection 0. The cache now contains 1 members
* Trying 192.0.2.31...
</span><span class="gp">* STATE: CONNECT =&gt;</span><span class="w"> </span>WAITCONNECT handle 0x600057800<span class="p">;</span> line 1455 <span class="o">(</span>connection <span class="c">#0)</span>
<span class="go">
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class="gp">0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Connected to www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud (54.229.163.31) port 443 (#</span>0<span class="o">)</span>
<span class="go">
</span><span class="gp">* STATE: WAITCONNECT =&gt;</span><span class="w"> </span>SENDPROTOCONNECT handle 0x600057800<span class="p">;</span> line 1562 <span class="o">(</span>connection <span class="c">#0)</span>
<span class="go">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* ALPN, offering h2

... portion omitted for brevity ...

</span><span class="gp">&lt; Set-Cookie: mage-messages=%5B%5D;</span><span class="w"> </span><span class="nv">expires</span><span class="o">=</span>Wed, 22-Nov-2017 17:39:58 GMT<span class="p">;</span> Max-Age<span class="o">=</span>31536000<span class="p">;</span> <span class="nv">path</span><span class="o">=</span>/
<span class="go">&lt; Pragma: cache
&lt; Expires: Wed, 23 Nov 2016 17:39:56 GMT
&lt; Cache-Control: max-age=86400, public, s-maxage=86400, stale-if-error=5, stale-while-revalidate=5
&lt; X-Magento-Tags: cb_welcome_popup store cb cb_store_info_mobile cb_header_promotional_bar cb_store_info cb_discount-promo-bar cpg_2 cb_83 cb_81 cb_84 cb_85 cb_86 cb_87 cb_88 cb_89 p5646 catalog_product p5915 p6040 p6197 p6227 p7095 p6109 p6122 p6331 p7592 p7651 p7690
&lt; Fastly-Module-Enabled: yes
&lt; Strict-Transport-Security: max-age=31536000
    &lt; Content-Security-Policy: upgrade-insecure-requests
    &lt; X-Content-Type-Options: nosniff
</span><span class="gp">    &lt; X-XSS-Protection: 1;</span><span class="w"> </span><span class="nv">mode</span><span class="o">=</span>block
<span class="go">    &lt; X-Frame-Options: SAMEORIGIN
    &lt; X-Platform-Server: i-dff64b52
    &lt;
</span><span class="gp">    * STATE: PERFORM =&gt;</span><span class="w"> </span>DONE handle 0x600057800<span class="p">;</span> line 1955 <span class="o">(</span>connection <span class="c">#0)</span>
<span class="go">    * multi_done
      0     0    0     0    0     0      0      0 --:--:--  0:00:02 --:--:--     0
</span><span class="gp">    * Connection #</span>0 to host www.mymagento.biz.c.sv7gVom4qrpek.ent.magento.cloud left intact
<span class="go">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p class="bs-callout-info">For detailed information on hits and misses, see <a href="https://docs.fastly.com/guides/performance-tuning/understanding-cache-hit-and-miss-headers-with-shielded-services">Understanding cache HIT and MISS headers with shielded services</a> in the Fastly documentation.</p>

<h3 id="curl">Resolve errors found in response headers</h3>

<p>This section provides suggestions for resolving errors returned when checking response headers using the Fastly API.</p>

<h4 id="no-module">Fastly module is not enabled</h4>

<p>If the Fastly module is not enabled (<code class="language-plaintext highlighter-rouge">Fastly-Module-Enabled: no</code>) or if the header is missing, <a href="/devdocs-archive/2.2/cloud/env/environments-ssh.html#magento-cli">use SSH to log in</a> to the project. Then, run the following command to check the module status.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>php bin/magento module:status Fastly_Cdn
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Based on the status returned, use the following instructions to update the Fastly configuration.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Module does not exist</code>—If the module does not exist <a href="https://github.com/fastly/fastly-magento2/blob/master/Documentation/INSTALLATION.md">install and configure</a> the Fastly CDN Module for Magento 2 in an Integration branch. After installation completes, enable and configure the module. See <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html">Set up Fastly</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Module is disabled</code>—If the Fastly module is disabled, update the environment configuration on an Integration branch in your local environment to enable it. Then, push the changes to Staging and Production. See <a href="/devdocs-archive/2.2/cloud/howtos/install-components.html#manage">Manage extensions</a>.</p>

    <p>If you use <a href="/devdocs-archive/2.2/cloud/live/sens-data-over.html#cloud-config-specific-recomm">Configuration Management</a>, check the Fastly CDN module status in the <code class="language-plaintext highlighter-rouge">app/etc/config.php</code> configuration file before you push changes to the Production or Staging environment.</p>

    <p>If the module is not enabled (<code class="language-plaintext highlighter-rouge">Fastly_CDN =&gt; 0</code>) in the <code class="language-plaintext highlighter-rouge">config.php</code> file, delete the file and run the following command to update <code class="language-plaintext highlighter-rouge">config.php</code> with the latest configuration settings.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bin/magento magento-cloud:scd-dump
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ul>

<h4 id="no-VCL">Fastly VCL has not been uploaded</h4>

<p>If the Fastly VCL has not been uploaded (<code class="language-plaintext highlighter-rouge">Fastly-Magento-VCL-Uploaded</code>: <code class="language-plaintext highlighter-rouge">false</code>), use the <em>Upload VCL</em> option in the Magento Admin UI to upload it. See <a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html#upload-vcl-snippets">Upload Fastly VCL snippets</a>.</p>

<h4 id="xcache-miss">X-Cache contains only MISS, no HIT</h4>

<p>If the <code class="language-plaintext highlighter-rouge">X-Cache</code> header contains <code class="language-plaintext highlighter-rouge">HIT</code> (<code class="language-plaintext highlighter-rouge">HIT, HIT</code> or <code class="language-plaintext highlighter-rouge">HIT, MISS</code>), it indicates that Fastly returns the cached content successfully.</p>

<p>If the <code class="language-plaintext highlighter-rouge">X-Cache</code> header is <code class="language-plaintext highlighter-rouge">MISS, MISS</code> and does not contain <code class="language-plaintext highlighter-rouge">HIT</code>, run the <code class="language-plaintext highlighter-rouge">curl</code> command again to make sure the page was not recently purged from the cache.</p>

<p>If you get the same result, use the <a href="#curl"><code class="language-plaintext highlighter-rouge">curl</code> commands</a> and verify the <a href="#response-headers">response headers</a>:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Pragma</code> is <code class="language-plaintext highlighter-rouge">cache</code></li>
  <li><code class="language-plaintext highlighter-rouge">X-Magento-Tags</code> exists</li>
  <li><code class="language-plaintext highlighter-rouge">Cache-Control: max-age</code> is greater than 0</li>
</ul>

<p>If the issue persists, another extension is likely resetting these headers. Repeat the following procedure in the Staging environment, disabling all extensions and re-enabling each one to determine which extension is resetting the headers. After you identify the extension causing the problem, you must disable it in the Production environment.</p>

<ol>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/onboarding/onboarding-tasks.html#admin">Log in</a> to the Magento Admin UI.</p>
  </li>
  <li>
    <p>Navigate to <strong>Stores</strong> &gt; <strong>Settings</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>Advanced</strong>.</p>
  </li>
  <li>
    <p>In the <em>Disable Modules Output</em> section in the right pane, locate and disable all of your extensions.</p>
  </li>
  <li>
    <p>Click <strong>Save Config</strong>.</p>
  </li>
  <li>
    <p>Click <strong>System</strong> &gt; <strong>Tools</strong> &gt; <strong>Cache Management</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Flush Magento Cache</strong>.</p>
  </li>
  <li>
    <p>Complete the following steps for each extension potentially causing issues with Fastly headers:</p>

    <ul>
      <li>
        <p>Enable one extension at a time, save the configuration, and flush the Magento cache.</p>
      </li>
      <li>
        <p>Run the <a href="#curl"><code class="language-plaintext highlighter-rouge">curl</code> commands</a> to verify the <a href="#response-headers">response headers</a>.</p>
      </li>
    </ul>

    <p>Repeat this process for each extension. If the Fastly response headers no longer display, you have identified the extension causing issues with Fastly.</p>
  </li>
</ol>

<p>After you identify the extension that is resetting Fastly headers, contact the extension developer for additional assistance. We cannot provide fixes or updates to make third-party extensions work with Fastly caching.</p>

<h2 id="rollback-fastly-configuration-changes">Rollback Fastly configuration changes</h2>

<p>If custom VCL snippet updates or other Fastly configuration changes cause a Magento Commerce Cloud site to break or return errors, use the Fastly API <a href="https://docs.fastly.com/api/config#version_0b79ae1ba6aee61d64cc4d43fed1e0d5">activate</a> command to rollback to an earlier VCL version. You cannot rollback the VCL version from the Magento Admin UI.</p>

<p class="procedure">To rollback the VCL version:</p>

<ol>
  <li>
    <p>To get a list of the available VCL versions for a service, run the following command</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-H</span> <span class="s2">"Fastly-Key: &lt;FASTLY_API_TOKEN&gt;"</span> https://api.fastly.com/service/&lt;FASTLY_SERVICE_ID&gt;/version/
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Run the following command to change the active VCL version to a specified version.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-H</span> <span class="s2">"Fastly-Key: &lt;FASTLY_API_TOKEN&gt;"</span> <span class="nt">-H</span> <span class="s1">'Content-Type: application/json'</span> <span class="nt">-H</span> <span class="s2">"Accept: application/json"</span> <span class="nt">-X</span> PUT https://api.fastly.com/service/&lt;FASTLY_SERVICE_ID&gt;/version/&lt;Version <span class="c">#&gt;/activate</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<p>For details about using the Fastly API to review and manage VCL, see <a href="/devdocs-archive/2.2/cloud/cdn/cloud-vcl-custom-snippets.html#manage-custom-vcl-snippets-using-the-api">Manage VCL using the API</a>.</p>

<!-- Link definitions -->


			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  
  <div class="page-updated">
    <img src="/devdocs-archive/2.2/i/icons/time.svg" alt="Updated" />
    <time id="last-modified-at" itemprop="dateModified" datetime="2019-12-20">
      Dec 20th, 2019
    </time>
  </div>
  

  

  

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      

<ul class="nav footer-links" role="menu">

  <li class="" role="menuitem"><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a></li>

  <li class="" role="menuitem"><a href="https://glossary.magento.com/">Glossary</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/privacy/">Privacy Policy</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/">Terms of Service</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/licensing/">License/Trademark FAQ</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/packages-open-source.html">Third-Party Licenses</a></li>

</ul>

    </div>

		<div class="copyright-date">&copy; 2023 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs-archive/2.2/assets/js/app.min.js?ver=7"></script>





<script type="text/javascript" src="/devdocs-archive/2.2/common/js/last-modified-at.js"></script>
<script type="text/javascript" src="/devdocs-archive/2.2/common/js/glossary-link-enhancer.js"></script>


</body>
</html>

