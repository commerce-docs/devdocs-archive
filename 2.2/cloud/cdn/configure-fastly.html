<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Set up Fastly | Archived Magento 2.2 Developer Documentation</title>
	<meta name="description" content="Archived Magento 2 Developer Documentation.">

	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/app.css?ver=7" />
	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/print.css?ver=7" media="print"/>

	<link rel="stylesheet" href="/devdocs-archive/2.2/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />



<meta name="google-site-verification" content="3WFsoYwBe6UuxDwgs7bmd7t0YFQVzDpLpWLjNh0CUp8" />

	<script>
  var baseUrl = "/devdocs-archive/2.2";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c",
  };

  var indices = [
    {
      label: "DevDocs",
      name: "devdocs",
      facetFilters: [["guide_version: 2.2", "versionless: true"]],
      refinements: [
        {
          label: "Functional areas",
          attribute: "functional_areas"
        }
      ],
      baseUrl: "https://devdocs.magento.com"
    },
    {
      label: "User Guide",
      name: "merchdocs_ee",
      baseUrl: "https://docs.magento.com/m2/ee/user_guide"
    },
    {
      label: "MBI User Guide",
      name: "merchdocs-mbi",
      baseUrl: "https://docs.magento.com/mbi"
    },
    {
      label: "Marketplace User Guide",
      name: "merchdocs-marketplace",
      baseUrl: "https://docs.magento.com/marketplace/user_guide"
    },
    {
      label: "PWA",
      name: "pwa-devdocs",
      baseUrl: "https://magento.github.io/pwa-studio"
    },
    {
      label: "Order Management",
      name: "oms-en",
      baseUrl: "https://omsdocs.magento.com"
    }
  ];
</script>




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">


	<header class="site-header">
		

<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" href="/devdocs-archive/2.2/">
      <img src="/devdocs-archive/2.2/assets/i/m-logo.svg" alt=""><img src="/devdocs-archive/2.2/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      



      <!-- Main Navigation --><ul class="nav-main" role="menubar"><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Cloud basics</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/bk-cloud.html">Cloud Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/cloud-architecture.html">Cloud Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/release-notes/cloud-tools.html">Release Notes</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Cloud development</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup.html">Local development</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments.html">Configure Environments</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/extensions/">Magento Extensions Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Software Update Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/performance-best-practices/introduction.html">Performance Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Information</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/reference/cli/magento.html">Command-line Tools Reference</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/architecture/bk-architecture.html">Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/marketplace/eqp/v1/api.html">Marketplace EQP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mbi/docs/getting-started.html">Business Intelligence API</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/testing.html">Magento Testing Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mftf/docs/introduction.html">Functional Acceptance Testing (MFTF)</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li></ul></div></li><li class="nav-main-separator"></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/b2b/bk-b2b.html">B2B</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/compliance/industry-compliance.html">Compliance</a></li><li class="" role="menuitem"><a href="http://omsdocs.magento.com/en/">Order Management</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/tutorials/index.html">Rest Tutorials</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/customize_product.html">Customize Product Creation Form</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Customize Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/community/resources/support.html">Magento Support</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/videos/">Video Tutorials</a></li></ul></div></li></ul><!-- /.nav-main -->

    </div>

    <div class="nav-actions">
      
<div class="app-switcher">
  <div class="dropdown">
    <button id="app-switcher-trigger" class="app-switcher-trigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Documentation sites"></button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="app-switcher-trigger" role="menu">
      <div class="app-switcher-content">
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Developer</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://devdocs.magento.com/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce Developer Documentation">Commerce Developer Documentation</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="http://pwastudio.io/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=PWA Studio">PWA Studio</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
      </div>
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Merchant</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/m2/ee/user_guide/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce User Guide">Commerce User Guide</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/userguides/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/mbi/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Business Intelligence">Business Intelligence</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/marketplace/user_guide/getting-started.html?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Marketplace">Marketplace</a></li>
        
      </div>
      
      </div>
    </ul>
  </div>
</div>

    </div>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>

	</header>

	<div class="global-wrapper">
		
		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<button class="toc-toggler">Table of Contents</button>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Magento Commerce Cloud</h4>
		<div class="collapsible-navigation">
		    <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/bk-cloud.html">Overview</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/onboarding/onboarding-tasks.html">Onboarding tasks</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/cloud-architecture.html">Architecture</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/basic-information/starter-architecture.html">Starter architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/basic-information/starter-develop-deploy-workflow.html">Starter develop and deploy workflow</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/pro-architecture.html">Pro architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/pro-develop-deploy-workflow.html">Pro develop and deploy workflow</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/scaled-architecture.html">Scaled architecture</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/requirements/cloud-requirements.html">Technologies and requirements</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/cloud-composer.html">Composer</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/cli-ref-topic.html">Magento Cloud CLI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/ece-tools-reference.html">ece-tools package</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/git-integration.html">Git</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments-ssh.html">SSH and sFTP</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/new-relic.html">New Relic</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-integrate-blackfire.html">Blackfire.io</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/sendgrid.html">SendGrid</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup.html">Local development setup</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace.html">Prepare for manual setup</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-magento-prereqs.html">Install Magento prerequisites</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-ssh.html">Enable SSH keys</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-workspace-file-sys-owner.html">Set up the Magento file system owner</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-setup-env-2_clone.html">Clone and branch the project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/before/before-setup-env-install.html">Install Magento</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-deploy.html">First time deployment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/debug.html">Optional - Configure Xdebug</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/sample-data.html">Optional - Install sample data</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development.html">Docker development</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development-debug.html">Configure Xdebug for Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-database.html">Connect to the database</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-development-testing.html">Functional testing in Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/cloud-integrations.html">Integrations</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/bitbucket-integration.html">Bitbucket integration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/github-integration.html">GitHub integration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/integrations/health-notifications.html">Health notifications</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-first-steps.html">Import existing code into a project</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-prepare.html">Prepare your existing Magento Commerce system</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup-import-import.html">Import Magento Commerce code</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/configuration-overview.html">Configure your store</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/configure-best-practices.html">Best practices for store configuration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/paypal-onboarding.html">Set up PayPal</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/setup-b2b.html">Set up Magento B2B</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/setup-cron-jobs.html">Set up cron jobs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-multi-sites.html">Set up multiple Cloud websites or stores</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/install-components.html">Install, manage, and upgrade modules</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/howtos/custom-theme.html">Install a theme</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/configure/import-url-rewrites.html">Import URL Rewrites</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html">Configure Fastly services</a><ul><li class="active" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/configure-fastly.html">Set up Fastly</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly-custom-response.html">Customize error and maintenance pages</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-waf-service.html">Web Application Firewall</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-image-optimization.html">Image Optimization</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/cloud-vcl-custom-snippets.html">Custom VCL snippets</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-wordpress.html">Reroute requests to a CMS backend</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-badreferer.html">Block referral spam</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-whitelist.html">Secure access to the Magento Admin UI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-blocking.html">Custom VCL for blocking</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/cdn/trouble-fastly.html">Fastly troubleshooting</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments.html">Configure environments</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_magento-app.html">Application</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/set-cache.html">Set cache for static files</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/magento-env-yaml.html">Build and deploy</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/setup-notifications.html">Set up notifications</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/log-handlers.html">Logging handlers</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-intro.html">Environment variables</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environment-vars_magento.html">ADMIN variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-global.html">Global variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-build.html">Build variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-cloud.html">Cloud variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-deploy.html">Deploy variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/variables-post-deploy.html">Post-deploy variables</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/working-with-variables.html">Working with variables</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_routes.html">Routes</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-cache.html">Caching</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-redir.html">Redirects</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-routes-more-ssi.html">Server side includes</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services.html">Services</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-mysql.html">Set up MySQL service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-redis.html">Set up Redis service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-elastic.html">Set up Elasticsearch service</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-conf-files_services-rabbit.html">Set up RabbitMQ service</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/restore-environment.html">Restore an environment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/sens-data-over.html">Configuration management for store settings</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/sens-data-initial.html">Example of managing system-specific settings</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/projects.html">Manage your project</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-basic.html">Configure your project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-start.html">Project structure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/log-locations.html">Log locations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/user-admin.html">Create and manage users</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-branch.html">Manage branches with the Interface</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments-start.html">Manage branches with the CLI</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/profile-database-queries.html">Profile database queries</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/manage-disk-space.html">Manage disk space</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/monitor-performance.html">Monitor performance</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-webint-snap.html">Snapshots and backup management</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/optimize-cloud-deployment.html">Optimize deployment</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/cloud-deployment-process.html">Cloud deployment process</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/reduce-downtime.html">Zero downtime deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/static-content-deployment.html">Static content deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/smart-wizards.html">Smart wizards</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-live.html">Deploy your store</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/reference/discover-deploy.html">Deployment process</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/deploy/continuous-deployment.html">Continuous deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live-prot.html">Protective block</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live-sanity-check.html">Build and deploy on local</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-migrate-prereq.html">Prepare to deploy to Staging and Production</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-migrate.html">Deploy code and migrate static files and data</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/stage-prod-test.html">Test deployment</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/live.html">Go live and launch</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/go-live-checklist.html">Go live checklist</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/live/launch-steps.html">Launch steps</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble.html">Troubleshooting</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/troubleshoot-deployment.html">Troubleshoot deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_ce-creds.html">Incorrect credentials</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_proj-startover.html">Resolve issues with a new project</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble_comp-deploy-fail.html">Component deployment failure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/reset-cron-jobs.html">Reset cron jobs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-crypt-key-variable.html">Resolve issues with encryption key</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-error-html-minification.html">Resolve issues with HTML minification</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/trouble-google-analytics-deploy.html">Resolve issues with Google Analytics during deployment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/restore-configuration-files.html">Restore configuration files</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/site-availability.html">Site availability</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/robots-sitemap.html">Add site map and search engine robots</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/trouble/theme-troubleshooting.html">Theme troubleshooting</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade-parent.html">Upgrades and patches</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/ece-tools-upgrade-project.html">Upgrade to use ece-tools</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/ece-tools-update.html">Update ece-tools version</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-patch.html">Apply custom patches</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade.html">Upgrade Magento version</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/release-notes/cloud-tools.html">Release notes</a></li></ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">








<h1 class="page-heading">Set up Fastly</h1>
</section>

			<p><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html">Fastly</a> is required for Magento Commerce Cloud, and is used in Staging and Production environments. It works with Varnish to provide fast caching capabilities and a <a href="https://glossary.magento.com/content-delivery-network">Content Delivery Network</a> (CDN) for static assets. Fastly is not available in Integration environments.</p>

<p>This information gets you started with enabling and configuring Fastly caching services in your Staging and Production environments. We provide additional information for configuring backends and Origin shields, customizing error pages, and adding custom VCL snippets.</p>

<p>For VCL snippets, experience developing that code is required for advanced configurations.</p>

<p>The process for configuring Fastly includes:</p>

<ul>
  <li>Get Fastly credentials for Staging and Production environments</li>
  <li>Enable Fastly CDN caching in your environment</li>
  <li>Upload Fastly VCL snippets</li>
  <li>Advanced configurations including VCL snippets, as needed for your Magento Commerce sites</li>
</ul>

<h2 id="cloud-fastly-creds">Get Fastly credentials</h2>

<p>During project provisioning, Magento adds your project to the <a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html#fastly-service-account-and-credentials">Fastly service account</a> for Magento Commerce Cloud and adds the Fastly account credentials to the Staging and Production environment configuration.</p>

<p>You need the Fastly credentials to configure Fastly CDN services from the Magento Admin UI and to submit Fastly API requests.</p>

<p>Use the following methods to find and save the Fastly service ID and API token for your environment:</p>

<p class="procedure">To view your Fastly credentials:</p>

<ul>
  <li>
    <p>IaaS-mounted shared directory—On Pro projects, use SSH to connect to your server and get the Fastly credentials from the <code class="language-plaintext highlighter-rouge">/mnt/shared/fastly_tokens.txt</code> file.</p>
  </li>
  <li>
    <p>Local workspace—From the command line, use the Magento Cloud CLI to <a href="/devdocs-archive/2.2/cloud/before/before-setup-env-2_clone.html">list and review</a> Fastly environment variables.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>magento-cloud variable:get <span class="nt">-e</span> &lt;environment ID&gt;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Project Web UI—Check the following environment variables in the <em><a href="/devdocs-archive/2.2/cloud/project/projects.html#environment-configuration-variables">Environment configuration variables</a></em> section.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">CONFIG__DEFAULT__SYSTEM__FULL_PAGE_CACHE__FASTLY__FASTLY_API_TOKEN</code></p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">CONFIG__DEFAULT__SYSTEM__FULL_PAGE_CACHE__FASTLY__FASTLY_SERVICE_ID</code></p>
      </li>
    </ul>
  </li>
</ul>

<p class="bs-callout-info">If you cannot find the Fastly credentials for the Staging or Production environments, contact your Magento Technical Account Manager.</p>

<h2 id="cloud-fastly-config">Enable Fastly caching for your Cloud environments</h2>

<p><strong>Prerequisites:</strong></p>

<ul>
  <li>
    <p>Latest version of the <a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html#fastly-cdn-module-for-magento-2">Fastly CDN for Magento 2 module</a> installed in the Staging and Production environments. See <a href="#upgrade">Upgrade Fastly</a>.</p>
  </li>
  <li>
    <p><a href="#cloud-fastly-creds">Fastly credentials</a> for Magento Commerce Cloud Staging and Production environments</p>
  </li>
</ul>

<p class="procedure">To enable Fastly CDN caching in Staging and Production:</p>

<ol>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/onboarding/onboarding-tasks.html#admin">Log in</a> to the Magento Admin UI.</p>
  </li>
  <li>
    <p>Click <strong>Stores</strong> &gt; Settings &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong> and expand <strong>Full Page Cache</strong>.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud_fastly_menu.png" alt="Expand to select Fastly" width="650px" /></p>
  </li>
  <li>
    <p>In the <em>Caching Application</em> section, remove the selection from <strong>Use system value</strong>, and then select <strong>Fastly CDN</strong> from the drop-down list.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud-fastly_enable-admin.png" alt="Choose Fastly" width="550px" /></p>
  </li>
  <li>
    <p>Expand <strong>Fastly Configuration</strong> and <a href="https://github.com/fastly/fastly-magento2/blob/master/Documentation/CONFIGURATION.md#configure-the-module">choose caching options</a>.</p>
  </li>
  <li>
    <p>After configuring the caching options, click <strong>Save Config</strong> at the top of the page.</p>
  </li>
  <li>
    <p>Clear the cache according to the notification.</p>
  </li>
  <li>
    <p>Navigate back to <strong>Stores</strong> &gt; <strong>Settings</strong> &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong> &gt; <strong>Fastly Configuration</strong> to continue configuring Fastly.</p>
  </li>
</ol>

<h3 id="test-the-fastly-credentials">Test the Fastly credentials</h3>

<ol>
  <li>
    <p>On the Magento Admin UI, navigate to <strong>Stores</strong> &gt; Settings &gt; <strong>Configuration</strong> &gt; <strong>Advanced</strong> &gt; <strong>System</strong> &gt; <strong>Fastly Configuration</strong>.</p>
  </li>
  <li>
    <p>If needed, add the <strong>Fastly service ID</strong> and <strong>API token</strong> values for your project environment.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud/cloud-fastly-credentials-admin-ui.png" alt="Fastly credentials Admin UI" width="650px" /></p>

    <p class="bs-callout-info">Ignore the link to create a Fastly API token. Use the <a href="#cloud-fastly-creds">Fastly credentials (Service ID and API token) that Magento</a> provided.</p>
  </li>
  <li>
    <p>Click <strong>Test credentials</strong>.</p>
  </li>
  <li>
    <p>If the test succeeds, click <strong>Save Config</strong>, and then clear the cache.</p>

    <p>If the test fails, verify that the correct service ID and API token values match the credentials for the current environment.</p>

    <p>If the test fails again, submit a support ticket or contact your Technical Account Manager. For Pro projects, include the URLs for your Production and Staging sites.  For Starter projects, include the URLs for your <code class="language-plaintext highlighter-rouge">Master</code> and Staging site.</p>
  </li>
</ol>

<p class="bs-callout-info">If you need to change the Fastly API token credential for a Staging or Production environment, see <a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly.html#change-your-fastly-api-token">Change Fastly credentials</a>.</p>

<h3 id="upload-vcl-snippets">Upload VCL to Fastly</h3>

<p>After you enable the Fastly module, upload the default <a href="https://github.com/fastly/fastly-magento2/tree/master/etc/vcl_snippets">VCL code</a> to the Fastly servers.  This code provides a series of VCL snippets that specify the configuration settings to enable caching and other Fastly CDN services for your Magento Commerce Cloud.</p>

<p class="bs-callout-info">Fastly caching services do not work until you complete the initial upload of the Fastly VCL code for the  Staging and Production sites.</p>

<p class="procedure">To upload the Fastly VCL:</p>

<ol>
  <li>
    <p>In the <em>Fastly Configuration</em> section, click <strong>Upload VCL to Fastly</strong> as the following figure shows.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud_upload-vcl-to-fastly.png" alt="Upload a Magento VCL to Fastly" /></p>
  </li>
  <li>
    <p>After the upload completes, refresh the cache according to the notification at the top of the page.</p>
  </li>
</ol>

<h2 id="custom-configuration">Custom configuration</h2>

<p class="bs-callout-info">Before adding <a href="#custom-configuration">custom</a> or advanced configuration settings like <a href="#purge">updating purge settings</a> and configuring <a href="/devdocs-archive/2.2/cloud/cdn/fastly-image-optimization.html">Fastly image optimization</a>(Fastly IO), <a href="/devdocs-archive/2.2/cloud/cdn/trouble-fastly.html">verify</a> that the Fastly caching service works with the default configuration.</p>

<p>Configure the following features as needed:</p>

<ul>
  <li><a href="#backend">Configure backends and Origin shielding</a></li>
  <li><a href="/devdocs-archive/2.2/cloud/cdn/cloud-fastly-custom-response.html">Customize response pages</a></li>
  <li><a href="https://github.com/fastly/fastly-magento2/blob/master/Documentation/CONFIGURATION.md#further-configuration-options">Enable additional Fastly configuration options</a></li>
</ul>

<h3 id="backend">Configure backends and Origin shielding</h3>

<p>Backend settings provide fine tuning for Fastly performance with Origin shielding and timeouts. A <em>backend</em> is a specific location (IP or domain) with configured Origin shield and timeout settings for checking and providing cached content.</p>

<p><em>Origin shielding</em> routes all requests for your store to a specific Point of Presence (POP). When a request is received, the POP checks for cached content and provides it. If it is not cached, it continues to the Shield POP, then to the Origin server which caches the content. The shields reduce traffic directly to the origin.</p>

<p>The default Fastly VCL code specifies default values for Origin shielding and timeouts for your Magento Commerce Cloud sites. We recommend using the default values. In some case, you might need to modify the default values. For example, if you are getting a lot of time to first byte (TTFB) errors, you might need to adjust the <em>first byte timeout</em> value.</p>

<p class="bs-callout-info">If you need to integrate additional backends into your site such as a backend to serve blog content from a <a href="/devdocs-archive/2.2/cloud/cdn/fastly-vcl-wordpress.html">Wordpress</a> site, you must customize your Fastly service configuration to add the backend and handle the redirects from your Magento Commerce store to the Wordpress backend. For details, see <a href="https://github.com/fastly/fastly-magento2/blob/master/Documentation/Guides/Edge-Modules/EDGE-MODULE-OTHER-CMS-INTEGRATION.md">Fastly Edge Modules - Other CMS/Backend integration</a> in the Fastly module documentation.</p>

<p class="procedure">To review the backend settings configuration:</p>

<ol>
  <li>
    <p>Access and expand <strong>Fastly Configuration</strong>.</p>
  </li>
  <li>
    <p>Expand <strong>Backend settings</strong> and click the gear to check the default backend. A modal opens that shows current settings with options to change them.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud_fastly-backend.png" alt="Modify the backend" width="600px" /></p>
  </li>
  <li>
    <p>Select the <strong>Shield</strong> location (or datacenter) closest to your AWS region.
For example, if Staging is on the west coast of the United States (us-west-1), select the <code class="language-plaintext highlighter-rouge">sjc-ca-us</code> Fastly shield location. This is the POP that provides caching services.</p>

    <p>The following list shows which Fastly shield locations to use based an AWS region:</p>

    <ul>
      <li>ap-east-1 =&gt; hongkong-hk</li>
      <li>ap-northeast-1 =&gt; tyo-tokyo-jp, hnd-tokyo-jp</li>
      <li>ap-northeast-2 =&gt; tyo-tokyo-jp, hnd-tokyo-jp</li>
      <li>ap-southeast-1 =&gt; singapore-sg</li>
      <li>ap-southeast-2 =&gt; sydney-au</li>
      <li>ap-south-1 =&gt; singapore-sg</li>
      <li>ca-central-1 =&gt; yul-montreal-ca, iad-va-us, dca-dc-us, bwi-va-us</li>
      <li>eu-central-1 =&gt; frankfurt-de, hhn-frankfurt-de</li>
      <li>eu-north-1 =&gt; stockholm-bma</li>
      <li>eu-west-1 =&gt; london-uk, london_city-uk</li>
      <li>eu-west-2 =&gt; london-uk, london_city-uk</li>
      <li>eu-west-3 =&gt; cdg-par-fr</li>
      <li>sa-east-1 =&gt; gru-br-sa</li>
      <li>us-east-1 =&gt; iad-va-us, dca-dc-us, bwi-va-us</li>
      <li>us-east-2 =&gt; iad-va-us, dca-dc-us, bwi-va-us</li>
      <li>us-west-1 =&gt; sjc-ca-us, pao-ca-us</li>
      <li>us-west-2 =&gt; sea-wa-us</li>
    </ul>
  </li>
  <li>
    <p>Modify the timeout values (in microseconds) for the connection to the shield, time between bytes, and time for the first byte. We recommend keeping the default timeout settings.</p>
  </li>
  <li>
    <p>Optionally, select to <strong>Activate the backend and Shield after editing or saving</strong>.</p>
  </li>
  <li>
    <p>Click <strong>Upload</strong> to save your changes and upload them to the Fastly servers.</p>
  </li>
  <li>
    <p>In the Magento Admin, click <strong>Save Config</strong>.</p>
  </li>
</ol>

<p>For more information, see the Magento 2 <a href="https://github.com/fastly/fastly-magento2/blob/21b61c8189971275589219d418332798efc7db41/Documentation/Guides/BACKEND-SETTINGS.md">Backend settings guide</a> in the Fastly module documentation.</p>

<h3 id="purge">Configure purge options</h3>

<p>Fastly provides multiple types of purge options on your Magento Cache Management page including purging product category, product assets, and content. When enabled, Fastly watches for events to automatically purge those caches. If you disable a purge option, you can manually purge Fastly caches after finishing updates through the Cache Management page.</p>

<p>The options include:</p>

<ul>
  <li><strong>Purge category</strong>: Purges product category content (not product content) when you add and update a single product. You may want to keep this disabled and enable purge product, which purges products and product categories.</li>
  <li><strong>Purge product</strong>: Purges all product and product category content when saving a single modification to a product. Enabling purge product can be helpful to immediately get updates to customers when changing a price, adding a product option, and when product inventory is out-of-stock.</li>
  <li><strong>Purge CMS page</strong>: Purges page content when updating and adding pages to the Magento CMS. For example, you may want to purge when updating your Terms and Conditions or Return policy. If you rarely make these changes, you could disable automatic purging.</li>
  <li><strong>Soft purge</strong>: Sets changed content to stale and purges according to the stale timing. In combination with the stale timings your customers will be served stale content very fast while Fastly is updating the content in the background.</li>
</ul>

<p><img src="/devdocs-archive/2.2/common/images/cloud_fastly-purgeoptions.png" alt="Configure purge options" width="650px" /></p>

<p class="procedure">To configure Fastly purge options:</p>

<ol>
  <li>
    <p>In the <em>Fastly Configuration</em> section, expand <strong>Advanced</strong>.</p>
  </li>
  <li>
    <p>All purge options display. Select “Yes” per purge option to enable automatic purging. Select “No” to disable automatic purging, allowing you to manually purge caches through the Cache Management page.</p>
  </li>
  <li>
    <p>Click <strong>Save Config</strong> at the top of the page.</p>
  </li>
  <li>
    <p>After the page reloads, click <strong>Upload VCL to Fastly</strong> in the <em>Fastly Configuration</em> section.</p>
  </li>
</ol>

<p>For more information, see <a href="https://github.com/fastly/fastly-magento2/blob/21b61c8189971275589219d418332798efc7db41/Documentation/CONFIGURATION.md#further-configuration-options">the Fastly configuration options</a>.</p>

<h3 id="custom-vcl">Create custom VCL snippets</h3>

<p>For extensive instructions to create custom VCL snippets and needed edge dictionaries or ACLs, see <a href="/devdocs-archive/2.2/cloud/cdn/cloud-vcl-custom-snippets.html">Custom Fastly VCL snippets</a>.</p>

<h3 id="bulkaction">Extend Fastly timeout for the Magento Admin</h3>

<p>Fastly sets a 180 second-timeout for HTTPS requests to the Magento Admin, so you may encounter timeouts if you need to complete bulk actions that take longer than 3 minutes. In these cases, update the Fastly service configuration to change the <em>Admin path timeout</em>.</p>

<ol>
  <li>
    <p>In the <em>Fastly Configuration</em> section, expand <strong>Advanced</strong>.</p>
  </li>
  <li>
    <p>Set the <strong>Admin path timeout</strong> value in seconds. This value cannot be more than 10 minutes (600 seconds).</p>
  </li>
  <li>
    <p>Click <strong>Save Config</strong> at the top of the page.</p>
  </li>
  <li>
    <p>After the page reloads, click <strong>Upload VCL to Fastly</strong> in the <em>Fastly Configuration</em> section.</p>
  </li>
</ol>

<p>Fastly gets the Magento Admin path for generating the VCL file from the <code class="language-plaintext highlighter-rouge">app/etc/env.php</code> configuration file.</p>

<h3 id="geoip">Configure GeoIP handling</h3>

<p>The Fastly module includes GeoIP handling to automatically redirect visitors or provide a list of stores matching their obtained country code. If you already use a Magento extension for GeoIP handling, you may need to verify the features with Fastly options.</p>

<ol>
  <li>
    <p>In the <em>Fastly Configuration</em> section, expand <strong>Advanced</strong>.</p>
  </li>
  <li>
    <p>Scroll down and select <strong>Yes</strong> to <strong>Enable GeoIP</strong>. Additional configuration options display.</p>
  </li>
  <li>
    <p>For GeoIP Action, select if the visitor is automatically redirected with <strong>Redirect</strong> or provided a list of stores to select from with <strong>Dialog</strong>.</p>
  </li>
  <li>
    <p>For <strong>Country Mapping</strong>, click <strong>Add</strong> to enter a two-letter country code to map with a specific Magento store from a list. For a list of country codes, see <a href="https://en.wikipedia.org/wiki/ISO_3166-1_alpha-2">this site</a>.</p>

    <p><img src="/devdocs-archive/2.2/common/images/cloud_fastly-geo-code.png" alt="Add GeoIP country maps" /></p>
  </li>
  <li>
    <p>Click <strong>Save Config</strong> at the top of the page.</p>
  </li>
  <li>
    <p>After page reload, click <strong>Upload VCL to Fastly</strong> in the <em>Fastly Configuration</em> section.</p>
  </li>
</ol>

<p>Fastly also provides a series of <a href="https://docs.fastly.com/guides/vcl/geolocation-related-vcl-features">geolocation-related VCL features</a> for customized geolocation coding.</p>

<h2 id="dns">DNS configuration</h2>

<p>To enable Fastly caching on your Staging and Production sites, you need make the following changes to the DNS configuration for your site:</p>

<ul>
  <li>Set all necessary redirects, especially if you are migrating from an existing site</li>
  <li>Set the zone’s root resource record to address the hostname</li>
  <li>Lower the value for the Time-to-Live (TTL) to refresh DNS information to point customers to the correct Production store</li>
</ul>

<p>We recommend a significantly lower TTL value when switching the DNS record. This value tells the DNS how long to cache the DNS record. When shortened, it refreshes the DNS faster. For example, you can change the TTL value from 3 days to 10 minutes when you are testing your site. Be advised that shortening the TTL value  adds load to the web server.</p>

<p>After checking with your registrar about where to change your DNS settings, add a CNAME record for your website that points to the Fastly service: <code class="language-plaintext highlighter-rouge">prod.magentocloud.map.fastly.net</code>. If you use multiple hostnames for your site, you must add a CNAME record for each one.</p>

<p>CNAME records cannot be set for apex domains, also referred to as a naked or base domains. You must use <code class="language-plaintext highlighter-rouge">A</code> records for this.
<code class="language-plaintext highlighter-rouge">A</code> records map a domain name to the following Fastly IP addresses:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">151.101.1.124</code></li>
  <li><code class="language-plaintext highlighter-rouge">151.101.65.124</code></li>
  <li><code class="language-plaintext highlighter-rouge">151.101.129.124</code></li>
  <li><code class="language-plaintext highlighter-rouge">151.101.193.124</code></li>
</ul>

<p>Refer to <a href="/devdocs-archive/2.2/cloud/live/go-live-checklist.html">Go live checklist</a> for more information.</p>

<h3 id="fastly-tls">TLS and Fastly</h3>

<p>If you use TLS with Fastly enabled in your environment, you must provide your DNS provider with a TXT record from Fastly. We provide a Domain Validated SSL certificate with Subject Alternative Name enabled, issued by GlobalSign. When entering your <a href="/devdocs-archive/2.2/cloud/trouble/trouble.html">Support ticket</a> for DNS information and going live, let us know you are using TLS, provide your domain names, and request the TXT record. You can then send this record to your DNS provider. The domain validation process is executed by Fastly.</p>

<p>For details on this TXT record, see the Fastly <a href="https://docs.fastly.com/guides/securing-communications/domain-validation-for-tls-certificates#dns-text-record-verification">DNS TXT record validation</a>.</p>

<h2 id="upgrade">Upgrade the Fastly module</h2>

<p>Fastly updates the Fastly CDN for Magento 2 module to resolve issues, increase performance, and provide new features.
We recommend that you update the Fastly module in your Staging and Production environments to the <a href="https://github.com/fastly/fastly-magento2/releases">latest version</a>.</p>

<p>After you update the module, you must upload the VCL code to apply the changes to the Fastly service configuration.</p>

<p class="procedure">To check the version of Fastly CDN module for Magento 2:</p>

<ol>
  <li>
    <p>Change to the root directory of your Cloud environment.</p>
  </li>
  <li>
    <p>Use Composer to check the installed version.</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>composer show <span class="k">*</span>fastly<span class="k">*</span>
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>If the <a href="https://github.com/fastly/fastly-magento2/releases">latest release</a>is not installed, complete the steps to upgrade the Fastly module.</p>
  </li>
</ol>

<p class="procedure">To upgrade the Fastly module:</p>

<ol>
  <li>
    <p>In your local Integration environment, use the following module information to <a href="/devdocs-archive/2.2/cloud/howtos/install-components.html#update">upgrade the Fastly module</a>.</p>

    <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>module name: fastly/magento2
repository: https://github.com/fastly/fastly-magento2.git
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Push your updates to the Staging environment.</p>
  </li>
  <li>
    <p>Log in to the Magento Admin UI for your Staging environment to <a href="#upload-vcl-snippets">upload the VCL code</a>.</p>
  </li>
  <li>
    <p><a href="/devdocs-archive/2.2/cloud/cdn/trouble-fastly.html#verify-or-debug-fastly-services">Verify Fastly services</a> on the Magento Commerce Staging site.</p>
  </li>
</ol>

<p>After you verify Fastly services on the Staging site, repeat the upgrade process in the Production environment.</p>

<p class="bs-callout-warning">If you have added a custom VCL snippet that has the same name as a default snippet, you may need to verify and update those snippets after you upgrade the Fastly module. We do not recommend replacing existing default snippets with custom snippets of the same name. For details on custom VCL, see <a href="/devdocs-archive/2.2/cloud/cdn/cloud-vcl-custom-snippets.html">Custom Fastly VCL snippets</a>.</p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  
  <div class="page-updated">
    <img src="/devdocs-archive/2.2/i/icons/time.svg" alt="Updated" />
    <time id="last-modified-at" itemprop="dateModified" datetime="2020-01-15">
      Jan 15th, 2020
    </time>
  </div>
  

  

  

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      

<ul class="nav footer-links" role="menu">

  <li class="" role="menuitem"><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a></li>

  <li class="" role="menuitem"><a href="https://glossary.magento.com/">Glossary</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/privacy/">Privacy Policy</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/">Terms of Service</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/licensing/">License/Trademark FAQ</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/packages-open-source.html">Third-Party Licenses</a></li>

</ul>

    </div>

		<div class="copyright-date">&copy; 2023 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs-archive/2.2/assets/js/app.min.js?ver=7"></script>





<script type="text/javascript" src="/devdocs-archive/2.2/common/js/last-modified-at.js"></script>
<script type="text/javascript" src="/devdocs-archive/2.2/common/js/glossary-link-enhancer.js"></script>


</body>
</html>

