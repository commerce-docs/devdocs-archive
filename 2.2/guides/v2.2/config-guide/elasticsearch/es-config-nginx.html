<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Configure nginx and Elasticsearch | Archived Magento 2.2 Developer Documentation</title>
	<meta name="description" content="Archived Magento 2 Developer Documentation.">

	<link rel="stylesheet" href="/devdocs/2.2/assets/css/app.css?ver=7" />
	<link rel="stylesheet" href="/devdocs/2.2/assets/css/print.css?ver=7" media="print"/>

	<link rel="stylesheet" href="/devdocs/2.2/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />



<meta name="google-site-verification" content="3WFsoYwBe6UuxDwgs7bmd7t0YFQVzDpLpWLjNh0CUp8" />

	<script>
  var baseUrl = "/devdocs/2.2";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c",
  };

  var indices = [
    {
      label: "DevDocs",
      name: "devdocs",
      facetFilters: [["guide_version: 2.2", "versionless: true"]],
      refinements: [
        {
          label: "Functional areas",
          attribute: "functional_areas"
        }
      ],
      baseUrl: "https://devdocs.magento.com"
    },
    {
      label: "User Guide",
      name: "merchdocs_ee",
      baseUrl: "https://docs.magento.com/m2/ee/user_guide"
    },
    {
      label: "MBI User Guide",
      name: "merchdocs-mbi",
      baseUrl: "https://docs.magento.com/mbi"
    },
    {
      label: "Marketplace User Guide",
      name: "merchdocs-marketplace",
      baseUrl: "https://docs.magento.com/marketplace/user_guide"
    },
    {
      label: "PWA",
      name: "pwa-devdocs",
      baseUrl: "https://magento.github.io/pwa-studio"
    },
    {
      label: "Order Management",
      name: "oms-en",
      baseUrl: "https://omsdocs.magento.com"
    }
  ];
</script>




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">


	<header class="site-header">
		

<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" href="/devdocs/2.2/">
      <img src="/devdocs/2.2/assets/i/m-logo.svg" alt=""><img src="/devdocs/2.2/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      


<div class="version-switcher dropdown">
	<button class="btn dropdown-toggle" disabled>
		Magento 2.2
	</button>
</div>


      <!-- Main Navigation --><ul class="nav-main" role="menubar"><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Cloud basics</div>
              <ul><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/bk-cloud.html">Cloud Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/architecture/cloud-architecture.html">Cloud Architecture</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/release-notes/cloud-tools.html">Release Notes</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Cloud development</div>
              <ul><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/setup/first-time-setup.html">Local development</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/cloud/env/environments.html">Configure Environments</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/extensions/">Magento Extensions Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Software Update Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/performance-best-practices/introduction.html">Performance Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Information</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/reference/cli/magento.html">Command-line Tools Reference</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/architecture/bk-architecture.html">Architecture</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/marketplace/eqp/v1/api.html">Marketplace EQP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/mbi/docs/getting-started.html">Business Intelligence API</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/test/testing.html">Magento Testing Guide</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/mftf/docs/introduction.html">Functional Acceptance Testing (MFTF)</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li></ul></div></li><li class="nav-main-separator"></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/b2b/bk-b2b.html">B2B</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/compliance/industry-compliance.html">Compliance</a></li><li class="" role="menuitem"><a href="http://omsdocs.magento.com/en/">Order Management</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/rest/tutorials/index.html">Rest Tutorials</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/howdoi/customize_product.html">Customize Product Creation Form</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Customize Checkout</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/community/resources/support.html">Magento Support</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/videos/">Video Tutorials</a></li></ul></div></li></ul><!-- /.nav-main -->

    </div>

    <div class="nav-actions">
      
<div class="app-switcher">
  <div class="dropdown">
    <button id="app-switcher-trigger" class="app-switcher-trigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Documentation sites"></button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="app-switcher-trigger" role="menu">
      <div class="app-switcher-content">
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Developer</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://devdocs.magento.com/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce Developer Documentation">Commerce Developer Documentation</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="http://pwastudio.io/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=PWA Studio">PWA Studio</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
      </div>
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Merchant</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/m2/ee/user_guide/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce User Guide">Commerce User Guide</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/userguides/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/mbi/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Business Intelligence">Business Intelligence</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/marketplace/user_guide/getting-started.html?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Marketplace">Marketplace</a></li>
        
      </div>
      
      </div>
    </ul>
  </div>
</div>


      <div class="search-btn">
        <button class="search-trigger search-icon" aria-label="Search"></button>
      </div>

      <form class="quick-search" action="/devdocs/2.2/guides/v2.2/search.html" method="get" novalidate="novalidate">
        <input type="search" name="query" placeholder="Search" />
        <button class="quick-search-close" aria-label="Close Search">&times;</button>
      </form>

    </div>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>

	</header>

	<div class="global-wrapper">
		
		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<button class="toc-toggler">Table of Contents</button>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">Configuration Guide</h4>
		<div class="collapsible-navigation">
		    <ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bk-config-guide.html">Introduction</a></li><li class="" role="menuitem"><span>Security settings</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/security/google-recaptcha.html">Google reCAPTCHA</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/secy/hashing.html">Password hashing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/secy/secy-headers.html">Prevent cache poisoning</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/secy/secy-cron.html">Secure cron.php to run in a browser</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/security/two-factor-authentication.html">Two-Factor Authentication</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/secy/secy-xframe.html">X-Frame-Options header</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bootstrap/magento-bootstrap.html">Magento application initialization and bootstrap</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bootstrap/magento-modes.html">About Magento modes</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bootstrap/mage-dirs.html">Customize base directory paths (MAGE_DIRS)</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bootstrap/mage-profiler.html">Enable profiling (MAGE_PROFILER)</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/bootstrap/magento-how-to-set.html">Set the value of bootstrap parameters</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/">Pipeline Deployment</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/">Overview</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/technical-details.html">Technical Details</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/development-system.html">Development System Setup</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/build-system.html">Build System Setup</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/production-system.html">Production System Setup</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/prod_file-sys-perms.html">File systems access permissions</a></li><li class="" role="menuitem"><span>Examples</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/example/shared-configuration.html">Shared configuration</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/example/cli.html">Using CLI commands</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/pipeline/example/environment-variables.html">Using environment variables</a></li></ul></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/deployment/single-machine.html">Single machine deployment</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli.html">Command line configuration</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands.html">Get started with command-line configuration</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/logging.html">Logging</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-cache.html">Manage the cache</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-index.html">Manage the indexers</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-cron.html">Configure and run cron</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-compiler.html">Code compiler</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-mode.html">Set the Magento mode</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-urn.html">URN highlighter</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-depen.html">Dependency reports</a></li><li class="" role="menuitem"><span>Configuration management</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-export.html">Export the configuration</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-set.html">Set configuration values</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-config-mgmt-import.html">Import data from configuration files</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-i18n.html">Translation dictionaries and language packages</a></li><li class="" role="menuitem"><span>Static view files deployment</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-static-deploy-strategies.html">Static files deployment strategies</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-static-view.html">Deploy static view files</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-less-sass.html">Create symlinks to LESS files</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-test.html">Run unit tests</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-layout-xml.html">Convert layout XML files</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-perf-data.html">Generate data for performance testing</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-spt-util.html">Run the support utilities (Magento Commerce only)</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/config/config-magento.html">Magento configuration files</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/config/config-php.html">Magento's deployment configuration</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/config/config-files.html">Module configuration files</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/config/config-create.html">Create or extend configuration types</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/config/disable-module-output.html">Disable module output</a></li><li class="" role="menuitem"><span>Configuration reference</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-sens.html">Sensitive and system-specific</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-payment.html">Payment configuration paths reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-most.html">Other configuration paths reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-b2b.html">Magento Commerce for B2B Extension configuration paths reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-gitignore.html">.gitignore reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-var-name.html">Use environment variables to override configuration settings</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-configphp.html">config.php reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/prod/config-reference-envphp.html">env.php reference</a></li></ul></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cache.html">Configure caching</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cache/cache-types.html">Associate cache frontends with cache types</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cache/cache-options.html">Low-level cache options</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cache/static-content-signing.html">Static content signing</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/redis/config-redis.html">Configure Redis</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/redis/redis-pg-cache.html">Use Redis for the Magento page and default cache</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/redis/redis-session.html">Use Redis for session storage</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish.html">Configure and use Varnish</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish-install.html">Install Varnish</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish-configure.html">Configure Varnish and your web server</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish-magento.html">Configure Magento to use Varnish</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish-advanced.html">Advanced Varnish configuration</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/use-multiple-varnish-cache.html">How Magento cache clearing works with multiple Varnish instances</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/config-varnish-final.html">Final verification</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/use-varnish-cache.html">How Magento cache clearing works with Varnish</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/use-varnish-cache-how.html">How Varnish caching works</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/varnish/tshoot-varnish-503.html">Troubleshooting 503 errors</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/memcache/memcache.html">Use memcached for session storage</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/memcache/memcache_ubuntu.html">Install, configure, verify memcached on Ubuntu</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/memcache/memcache_centos.html">Install, configure, verify memcached on CentOS</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/memcache/memcache_magento.html">Configure Magento to use memcached</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-site/ms_over.html">Multiple websites or stores</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-site/change-increment-id.html">Change increment ID for a database entity on particular store</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-site/ms_websites.html">Set up multiple websites, stores, and store views in the Admin</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-site/ms_nginx.html">Tutorial—Set up multiple websites or stores with nginx</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-site/ms_apache.html">Tutorial—Set up multiple websites with Apache</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cron/custom-cron.html">Set up a custom cron job and cron group</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cron/custom-cron-ref.html">Custom cron job and cron group reference</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/cron/custom-cron-tut.html">Configure a custom cron job and cron group (tutorial)</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/db-profiler/db-profiler.html">Configure the database profiler</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-overview.html">Install and configure Elasticsearch (Magento Commerce only)</a><ul><li class="active" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-nginx.html">Configure nginx and Elasticsearch</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-apache.html">Configure Apache and Elasticsearch</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-stopwords.html">Configure Elasticsearch stopwords</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/configure-magento.html">Configure Magento to use Elasticsearch</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-downgrade.html">Change the Elasticsearch client</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/mq/rabbitmq-overview.html">Message Queues (Magento Commerce only)</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/mq/manage-mysql.html">Manage message queues</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-master/multi-master.html">Split database performance solution (Magento Commerce only)</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-master/multi-master_masterdb.html">Automatically configure master databases</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-master/multi-master_manual.html">Manually configure master databases</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-master/multi-master_verify.html">Verify split databases</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/multi-master/multi-master_slavedb.html">Set up optional database replication</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/log/log-intro.html">Custom Logging</a><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/log/log-magento.html">Magento logging in more detail</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/log/log-db.html">Example - logging database activity</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/log/custom-logger-handler.html">Example - logging to a custom log file</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/config-guide/sessions.html">How to locate your session files</a></li><li class="" role="menuitem"><span>GDPR compliance</span><ul><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/architecture/gdpr/magento-2x.html">Magento 2.x</a></li><li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/architecture/gdpr/magento-1x.html">Magento 1.x</a></li></ul></li></ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">



<span class="ee-only">Magento Commerce only</span>






<h1 class="page-heading">Configure nginx and Elasticsearch</h1>
</section>

			<h2 id="es-ws-secure-over">Overview of secure web server communication</h2>

<p>This topic discusses an example of securing communication between your web server and Elasticsearch using a combination of Transport Layer Security (TLS) encryption and <a href="http://tools.ietf.org/html/rfc2617">HTTP basic authentication</a>. You can optionally configure other types of authentication as well; we provide references for that information.</p>

<p>(An older term, Secure Sockets Layer (SSL), is frequently used interchangeably with TLS. In this topic, we refer to <em>TLS</em>.)</p>

<p class="bs-callout-warning">Unless otherwise noted, all commands in this topic must be entered as a user with <code class="language-plaintext highlighter-rouge">root</code> privileges.</p>

<h3 id="recommendations">Recommendations</h3>

<p>We recommend the following:</p>

<ul>
  <li>
    <p>Your web server uses TLS.</p>

    <p>TLS is beyond the scope of this topic; however, we strongly recommend you use a real certificate in production and not a self-signed certificate.</p>
  </li>
  <li>
    <p>Elasticsearch runs on the same host as a web server. Running Elasticsearch and the web server on different hosts is beyond the scope of this topic.</p>

    <p>The advantage of putting Elasticsearch and the web server on the same host is that it makes intercepting encrypted communication impossible. The Elasticsearch web server doesn’t have to be the same as the Magento web server; for example, Magento can run Apache and Elasticsearch can run nginx.</p>
  </li>
</ul>

<h3 id="more-information-about-tls">More information about TLS</h3>

<p>See one of the following resources:</p>

<ul>
  <li>
    <p>Apache</p>

    <ul>
      <li><a href="https://httpd.apache.org/docs/2.4/ssl/ssl_howto.html">Apache 2.4 strong encryption how-to</a></li>
      <li><a href="https://httpd.apache.org/docs/2.2/en/ssl/">Apache 2.2 SSL/TLS page</a></li>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-a-ssl-certificate-on-apache-for-ubuntu-14-04">How To Create a SSL Certificate on Apache for Ubuntu 14.04 (Digitalocean tutorial)</a></li>
      <li><a href="https://wiki.centos.org/HowTos/Https">Setting up an SSL secured Webserver with CentOS (CentOS wiki)</a></li>
    </ul>
  </li>
  <li>
    <p>Nginx</p>

    <ul>
      <li><a href="https://www.nginx.com/resources/admin-guide/nginx-ssl-termination/">Nginx SSL termination</a></li>
      <li><a href="https://www.digitalocean.com/community/tutorials/how-to-create-an-ssl-certificate-on-nginx-for-ubuntu-14-04">How To Create an SSL Certificate on Nginx for Ubuntu 14.04 (Digitalocean tutorial)</a></li>
      <li><a href="https://www.digicert.com/ssl-certificate-installation-nginx.htm">Nginx SSL Certificate Installation (digicert)</a></li>
    </ul>
  </li>
</ul>

<h2 id="es-nginx-proxy">Set up a proxy</h2>

<p>This section discusses how to configure nginx as an <em>unsecure</em> proxy so that Magento can use Elasticsearch running on this server. This section does not discuss setting up HTTP Basic authentication; that is discussed in <a href="#es-ws-secure-nginx">Secure communication with nginx</a>.</p>

<p class="bs-callout-info">The reason the proxy is not secured in this example is it’s easier to set up and verify. You can use TLS with this proxy if you want; to do so, make sure you add the proxy information to your secure server block configuration.</p>

<p>See one of the following sections for more information:</p>

<ul>
  <li><a href="#es-ws-secure-nginx-conf">Step 1: Specify additional configuration files in your global <code class="language-plaintext highlighter-rouge">nginx.conf</code></a></li>
  <li><a href="#es-ws-secure-nginx-proxy">Step 2: Set up nginx as a proxy</a></li>
</ul>

<h3 id="es-ws-secure-nginx-conf">Step 1: Specify additional configuration files in your global <code class="language-plaintext highlighter-rouge">nginx.conf</code></h3>

<p>Make sure your global <code class="language-plaintext highlighter-rouge">/etc/nginx/nginx.conf</code> contains the following line so it loads the other configuration files discussed in the following sections:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="gp">include /etc/nginx/conf.d/*.conf;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="es-ws-secure-nginx-proxy">Step 2: Set up nginx as a proxy</h3>

<p>This section discusses how to specify who can access the <a href="https://glossary.magento.com/nginx">nginx</a> server.</p>

<ol>
  <li>
    <p>Use a text editor to create a new file <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/magento_es_auth.conf</code> with the following contents:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="n">server</span> {
  <span class="n">listen</span> <span class="m">8080</span>;
  <span class="n">location</span> / {
   <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="n">localhost</span>:<span class="m">9200</span>;
  }
}
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Restart nginx:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>service nginx restart
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Verify the proxy works by entering the following command:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> http://localhost:&lt;proxy port&gt;/_cluster/health
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>For example, if your proxy uses port 8080:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> http://localhost:8080/_cluster/health
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>Messages similar to the following display to indicate success:</p>

    <div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="go">HTTP/1.1 200 OK
Date: Tue, 23 Feb 2016 20:38:03 GMT
</span><span class="gp">Content-Type: application/json;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>UTF-8
<span class="go">Content-Length: 389
Connection: keep-alive

{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":1,"number_of_data_nodes":1,"active_primary_shards":5,"active_shards":5,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":5,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":50.0}
</span></pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Continue with the next section.</p>
  </li>
</ol>

<h2 id="elastic-m2-configure">Configure Magento to use Elasticsearch</h2>

<p>This section discusses the minimum settings you must choose to test Elasticsearch with Magento 2.
For additional details about configuring Elasticsearch, see the <a href="http://docs.magento.com/m2/ee/user_guide/catalog/search-elasticsearch.html">Magento Commerce User Guide</a>.</p>

<p class="bs-callout-warning">Magento 2.3.1 adds support for Elasticsearch 6.x, and it is enabled by default.
Magento still provides modules for Elasticsearch 2.x and 5.x, but these must be enabled in order to use these versions.
Elasticsearch 2.x is still available but strongly discouraged. Versions 2.x and 5.x are <a href="https://www.elastic.co/support/eol">End of Life</a>.
If you must run Elasticsearch 2.x or 5.x with Magento 2.3.1, you must downgrade the Elasticsearch client to an older version.
Follow the instructions in <a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-downgrade.html">Change the Elasticsearch Client</a>.</p>

<h2 id="configure-elasticsearch-within-magento">Configure Elasticsearch within Magento</h2>

<p>To configure Magento to use Elasticsearch:</p>

<ol>
  <li>Log in to the Magento Admin as an administrator.</li>
  <li>Click <strong>Stores</strong> &gt; Settings &gt; <strong>Configuration</strong> &gt; <strong>Catalog</strong> &gt; <strong>Catalog</strong> &gt; <strong>Catalog Search</strong>.</li>
  <li>From the <strong>Search Engine</strong> list, select the correct Elasticsearch version as the following figure shows.
(The <strong>Elasticsearch 5.0+/6.0+</strong> options are not available for Magento 2.1.)</li>
</ol>

<p><img src="/devdocs/2.2/common/images/elastic_choose-in-admin-es6.png" alt="" width="650px" /></p>

<p>The following table lists the required configuration options to configure and test the connection with Magento.
Unless you changed Elasticsearch server settings, the defaults should work. Skip to the next step.</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Elasticsearch</strong> Server Hostname</td>
      <td>Enter the fully qualified hostname or IP address of the machine running Elasticsearch. Magento Commerce Cloud: Get this value from your integration system.</td>
    </tr>
    <tr>
      <td><strong>Elasticsearch Server Port</strong></td>
      <td>Enter the Elasticsearch web server proxy port. In our example, the port is 8080 but if you are using a secure proxy, it is typically 443. Magento Commerce Cloud: Get this value from your integration system.</td>
    </tr>
    <tr>
      <td><strong>Elasticsearch Index Prefix</strong></td>
      <td>Enter the Elasticsearch index prefix. If you use a single Elasticsearch instance for more than one Magento installation (Staging and Production environments), you must specify a unique prefix for each installation. Otherwise, you can use the default prefix magento2.</td>
    </tr>
    <tr>
      <td><strong>Enable Elasticsearch HTTP Auth</strong></td>
      <td>Click <strong>Yes</strong> only if you enabled authentication for your Elasticsearch server. If so, provide a username and password in the provided fields.</td>
    </tr>
  </tbody>
</table>

<ol start="4">
  <li>Click <strong>Test Connection</strong>.</li>
</ol>

<p>You will see either:</p>

<p><img src="/devdocs/2.2/common/images/elastic_test-success.png" alt="" /></p>

<p>Continue with:</p>

<ul>
  <li><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-apache.html">Configure Apache and Elasticsearch</a></li>
  <li><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-nginx.html">Configure nginx and Elasticsearch</a></li>
</ul>

<p>or you will see:</p>

<p><img src="/devdocs/2.2/common/images/elastic_test-fail.png" alt="" /></p>

<p>If so, try the following:</p>

<ul>
  <li>Make sure the Elasticsearch server is running.</li>
  <li>If the Elasticsearch server is on a different host from Magento, log in to the Magento server and ping the Elasticsearch host. Resolve network connectivity issues and test the connection again.</li>
  <li>Examine the command window in which you started Elasticsearch for stack traces and exceptions. You must resolve those before you continue. In particular, make sure you started Elasticsearch as a user with <code class="language-plaintext highlighter-rouge">root</code> privileges.</li>
  <li>Make sure that <a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-overview.html#firewall-selinux">UNIX firewall and SELinux</a> are both disabled, or set up rules to enable Elasticsearch and Magento to communicate with each other.</li>
  <li>Verify the value of the <strong>Elasticsearch Server Hostname</strong> field. Make sure the server is available. You can try the server’s IP address instead.</li>
  <li>Use the command <code class="language-plaintext highlighter-rouge">netstat -an | grep **listen-port**</code> command to verify that the port specified in the <strong>Elasticsearch Server Port</strong> field is not being used by another process.</li>
</ul>

<p>For example, to see if Elasticsearch is running on its default port, use the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>  netstat <span class="nt">-an</span> | <span class="nb">grep </span>9200
</pre></td></tr></tbody></table></code></pre></div></div>

<p>If Elasticsearch is running on port 9200, it displays similar to the following:
  <code class="language-plaintext highlighter-rouge">tcp        0      0 :::9200            :::*          LISTEN</code></p>

<h2 id="es-reindex">Reindexing catalog search and refreshing the full page cache</h2>

<p>After you change Magento’s Elasticsearch configuration, you must reindex the catalog search index and refresh the full page cache using the Admin or command line.</p>

<p>To refresh the cache using the Admin:</p>

<ol>
  <li>In the Admin, click <strong>System</strong> &gt; <strong>Cache Management</strong>.</li>
  <li>Select the checkbox next to <strong>Page Cache</strong>.</li>
  <li>From the <strong>Actions</strong> list in the upper right, click <strong>Refresh</strong>.
The following figure shows an example.
<img src="/devdocs/2.2/common/images/solr_refresh-cache.png" alt="" width="600px" /></li>
</ol>

<p>To clean the cache using the command line, use the <a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-cache.html#config-cli-subcommands-cache-clean"><code class="language-plaintext highlighter-rouge">magento cache:clean</code></a> command.</p>

<p>To reindex using the command line:</p>

<ol>
  <li>Log in to your Magento server as, or switch to, the <a href="/devdocs/2.2/guides/v2.2/install-gde/prereq/apache-user.html">Magento file system owner</a>.</li>
  <li>Enter any of the following commands:</li>
</ol>

<p>Enter the following command to reindex the catalog search index only:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bin/magento indexer:reindex catalogsearch_fulltext
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Enter the following command to reindex all indexers:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>bin/magento indexer:reindex
</pre></td></tr></tbody></table></code></pre></div></div>

<ol>
  <li>Wait until reindexing completes.</li>
</ol>

<p class="bs-callout-info">Unlike the cache, indexers are updated by a cron job. Make sure <a href="/devdocs/2.2/guides/v2.2/config-guide/cli/config-cli-subcommands-cron.html">cron is enabled</a> before you start using Elasticsearch.</p>

<h2 id="es-ws-secure-nginx">Secure communication with nginx</h2>

<p>This section discusses how to set up <a href="http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html">HTTP Basic authentication</a> with your secure proxy. Use of TLS and HTTP Basic authentication together prevents anyone from intercepting communication with Elasticsearch or with your Magento server.</p>

<p>Because nginx natively supports HTTP Basic authentication, we recommend it over, for example, <a href="https://www.nginx.com/resources/wiki/modules/auth_digest/">Digest authentication</a>, which isn’t recommended in production.</p>

<p>Additional resources:</p>

<ul>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-password-authentication-with-nginx-on-ubuntu-14-04">How To Set Up Password Authentication with Nginx on Ubuntu 14.04 (Digitalocean)</a></li>
  <li><a href="https://www.howtoforge.com/basic-http-authentication-with-nginx">Basic HTTP Authentication With Nginx (HowtoForge)</a></li>
  <li><a href="https://gist.github.com/karmi/b0a9b4c111ed3023a52d">Example Nginx Configurations for Elasticsearch</a></li>
</ul>

<p>See the following sections for more information:</p>

<ul>
  <li><a href="#es-ws-secure-nginx-pwd">Step 1: Create passwords</a></li>
  <li><a href="#es-ws-secure-nginx-access">Step 2: Set up access to nginx</a></li>
  <li><a href="#es-ws-secure-nginx-context">Step 3: Set up a restricted context for Elasticsearch</a></li>
  <li><a href="#es-ws-secure-verify">Verify communication is secure</a></li>
</ul>

<h3 id="es-ws-secure-nginx-pwd">Step 1: Create a password</h3>

<p>We recommend you use the Apache <code class="language-plaintext highlighter-rouge">htpasswd</code> command to encode passwords for a user with access to Elasticsearch (named <code class="language-plaintext highlighter-rouge">magento_elasticsearch</code> in this example).</p>

<p>To create a password:</p>

<ol>
  <li>
    <p>Enter the following command to determine if <code class="language-plaintext highlighter-rouge">htpasswd</code> is already installed:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>which htpasswd
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>If a path displays, it is installed; if the command returns no output, <code class="language-plaintext highlighter-rouge">htpasswd</code> is not installed.</p>
  </li>
  <li>
    <p>If necessary, install <code class="language-plaintext highlighter-rouge">htpasswd</code>:</p>

    <ul>
      <li>Ubuntu: <code class="language-plaintext highlighter-rouge">apt-get -y install apache2-utils</code></li>
      <li>CentOS: <code class="language-plaintext highlighter-rouge">yum -y install httpd-tools</code></li>
    </ul>
  </li>
  <li>
    <p>Create a <code class="language-plaintext highlighter-rouge">/etc/nginx/passwd</code> directory to store passwords:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/nginx/passwd
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>htpasswd <span class="nt">-c</span> /etc/nginx/passwd/.&lt;filename&gt; &lt;username&gt;
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p class="bs-callout-info">For security reasons, <code class="language-plaintext highlighter-rouge">&lt;filename&gt;</code> should be hidden; that is, it must start with a period. An example follows.</p>

    <p>Example:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir</span> <span class="nt">-p</span> /etc/nginx/passwd
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>htpasswd <span class="nt">-c</span> /etc/nginx/passwd/.magento_elasticsearch magento_elasticsearch
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>Follow the prompts on your screen to create the user’s password.</p>
  </li>
  <li>
    <p><em>(Optional).</em> To add another user to your password file, enter the same command without the <code class="language-plaintext highlighter-rouge">-c</code> (create) option:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>htpasswd /etc/nginx/passwd/.&lt;filename&gt; &lt;username&gt;
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Verify that the contents of <code class="language-plaintext highlighter-rouge">/etc/nginx/passwd</code> is correct.</p>
  </li>
</ol>

<h3 id="es-ws-secure-nginx-access">Step 3: Set up access to nginx</h3>

<p>This section discusses how to specify who can access the nginx server.</p>

<p class="bs-callout-warning">The example shown is for an <em>unsecure</em> proxy. To use a secure proxy, add the following contents (except the listen port) to your secure server block.</p>

<p>Use a text editor to modify either <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/magento_es_auth.conf</code> (unsecure) or your secure server block with the following contents:</p>

<div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="n">server</span> {
 <span class="n">listen</span> <span class="m">8080</span>;
 <span class="n">server_name</span> <span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>;

 <span class="n">location</span> / {
  <span class="n">limit_except</span> <span class="n">HEAD</span> {
    <span class="n">auth_basic</span> <span class="s2">"Restricted"</span>;
    <span class="n">auth_basic_user_file</span>  /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>/.<span class="n">htpasswd_magento_elasticsearch</span>;
  }
  <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9200</span>;
  <span class="n">proxy_redirect</span> <span class="n">off</span>;
  <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">host</span>;
  <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
 }

 <span class="n">location</span> /<span class="err">_</span><span class="n">aliases</span> {
  <span class="n">auth_basic</span> <span class="s2">"Restricted"</span>;
  <span class="n">auth_basic_user_file</span>  /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>/.<span class="n">htpasswd_magento_elasticsearch</span>;
  <span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9200</span>;
  <span class="n">proxy_redirect</span> <span class="n">off</span>;
  <span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">host</span>;
  <span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
 }

 <span class="n">include</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">auth</span>/*.<span class="n">conf</span>;
}
</pre></td></tr></tbody></table></code></pre></div></div>

<p class="bs-callout-info">The Elasticsearch listen port shown in the preceding example are examples only. For security reasons, we recommend you use a non-default listen port for Elasticsearch.</p>

<h3 id="es-ws-secure-nginx-context">Step 4: Set up a restricted context for Elasticsearch</h3>

<p>This section discusses how to specify who can access the Elasticsearch server.</p>

<ol>
  <li>
    <p>Enter the following command to create a new directory to store the authentication configuration:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir</span> /etc/nginx/auth/
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>Use a text editor to create a new file <code class="language-plaintext highlighter-rouge">/etc/nginx/auth/magento_elasticsearch.conf</code> with the following contents:</p>

    <div class="language-conf highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">location</span> /<span class="n">elasticsearch</span> {
<span class="n">auth_basic</span> <span class="s2">"Restricted - elasticsearch"</span>;
<span class="n">auth_basic_user_file</span> /<span class="n">etc</span>/<span class="n">nginx</span>/<span class="n">passwd</span>/.<span class="n">htpasswd_magento_elasticsearch</span>;

<span class="n">proxy_pass</span> <span class="n">http</span>://<span class="m">127</span>.<span class="m">0</span>.<span class="m">0</span>.<span class="m">1</span>:<span class="m">9200</span>;
<span class="n">proxy_redirect</span> <span class="n">off</span>;
<span class="n">proxy_set_header</span> <span class="n">Host</span> $<span class="n">host</span>;
<span class="n">proxy_set_header</span> <span class="n">X</span>-<span class="n">Forwarded</span>-<span class="n">For</span> $<span class="n">proxy_add_x_forwarded_for</span>;
}
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>If you set up a secure proxy, delete <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/magento_es_auth.conf</code>.</li>
  <li>
    <p>Restart nginx and continue with the next section:</p>

    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>service nginx restart
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
</ol>

<h2 id="es-ws-secure-verify">Verify communication is secure</h2>

<p>This section discusses two ways to verify that HTTP Basic authentication is working:</p>

<ul>
  <li>Using a <code class="language-plaintext highlighter-rouge">curl</code> command to verify you must enter a username and password to get cluster status</li>
  <li>Configuring HTTP Basic authentication in the Magento Admin</li>
</ul>

<h3 id="use-a-curl-command-to-verify-cluster-status">Use a <code class="language-plaintext highlighter-rouge">curl</code> command to verify cluster status</h3>

<p>Enter the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> http://&lt;<span class="nb">hostname</span>, ip, or localhost&gt;:&lt;proxy port&gt;/_cluster/health
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For example, if you enter the command on the Elasticsearch server and your proxy uses port 8080:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> http://localhost:8080/_cluster/health
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The following message displays to indicate authentication failed:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="go">HTTP/1.1 401 Unauthorized
Date: Tue, 23 Feb 2016 20:35:29 GMT
Content-Type: text/html
Content-Length: 194
Connection: keep-alive
WWW-Authenticate: Basic realm="Restricted"

</span><span class="gp">&lt;html&gt;</span><span class="w">
</span><span class="gp">&lt;head&gt;</span>&lt;title&gt;401 Authorization Required&lt;/title&gt;&lt;/head&gt;
<span class="gp">&lt;body bgcolor="white"&gt;</span><span class="w">
</span><span class="gp">  &lt;center&gt;</span>&lt;h1&gt;401 Authorization Required&lt;/h1&gt;&lt;/center&gt;
<span class="go">
</span><span class="gp">&lt;/body&gt;</span><span class="w">
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span></pre></td></tr></tbody></table></code></pre></div></div>

<p>Now try the following command:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> <span class="nt">-u</span> &lt;username&gt;:&lt;password&gt; http://&lt;<span class="nb">hostname</span>, ip, or localhost&gt;:&lt;proxy port&gt;/_cluster/health
</pre></td></tr></tbody></table></code></pre></div></div>

<p>For example:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-i</span> <span class="nt">-u</span> magento_elasticsearch:mypassword http://localhost:8080/_cluster/health
</pre></td></tr></tbody></table></code></pre></div></div>

<p>This time the command succeeds with a message similar to the following:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="go">HTTP/1.1 200 OK
Date: Tue, 23 Feb 2016 20:38:03 GMT
</span><span class="gp">Content-Type: application/json;</span><span class="w"> </span><span class="nv">charset</span><span class="o">=</span>UTF-8
<span class="go">Content-Length: 389
Connection: keep-alive

{"cluster_name":"elasticsearch","status":"yellow","timed_out":false,"number_of_nodes":1,"number_of_data_nodes":1,"active_primary_shards":5,"active_shards":5,"relocating_shards":0,"initializing_shards":0,"unassigned_shards":5,"delayed_unassigned_shards":0,"number_of_pending_tasks":0,"number_of_in_flight_fetch":0,"task_max_waiting_in_queue_millis":0,"active_shards_percent_as_number":50.0}
</span></pre></td></tr></tbody></table></code></pre></div></div>

<h3 id="configure-http-basic-authentication-in-the-magento-admin">Configure HTTP Basic authentication in the Magento Admin</h3>

<p>Perform the same tasks as discussed in <a href="#elastic-m2-configure">Configure Magento to use Elasticsearch</a> <em>except</em> click <strong>Yes</strong> from the <strong>Enable Elasticsearch HTTP Auth</strong> list and enter your username and password in the provided fields.</p>

<p>Click <strong>Test Connection</strong> to make sure it works and then click <strong>Save Config</strong>.</p>

<p>You must flush the Magento cache and reindex before you continue.</p>

<p class="ref-header">Next step</p>

<p><a href="/devdocs/2.2/guides/v2.2/config-guide/elasticsearch/es-config-stopwords.html">Configure Elasticsearch stopwords</a></p>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  
  <div class="page-updated">
    <img src="/devdocs/2.2/i/icons/time.svg" alt="Updated" />
    <time id="last-modified-at" itemprop="dateModified" datetime="2019-12-03">
      Dec 3rd, 2019
    </time>
  </div>
  

  

  

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      

<ul class="nav footer-links" role="menu">

  <li class="" role="menuitem"><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a></li>

  <li class="" role="menuitem"><a href="https://glossary.magento.com/">Glossary</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/privacy/">Privacy Policy</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/">Terms of Service</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/licensing/">License/Trademark FAQ</a></li>

  <li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>

  <li class="" role="menuitem"><a href="/devdocs/2.2/guides/v2.2/release-notes/packages-open-source.html">Third-Party Licenses</a></li>

</ul>

    </div>

		<div class="copyright-date">&copy; 2023 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs/2.2/assets/js/app.min.js?ver=7"></script>





<script type="text/javascript" src="/devdocs/2.2/common/js/last-modified-at.js"></script>
<script type="text/javascript" src="/devdocs/2.2/common/js/glossary-link-enhancer.js"></script>


</body>
</html>

