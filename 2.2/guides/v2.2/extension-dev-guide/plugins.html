<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Plugins (Interceptors) | Archived Magento 2.2 Developer Documentation</title>
	<meta name="description" content="Archived Magento 2 Developer Documentation.">

	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/app.css?ver=7" />
	<link rel="stylesheet" href="/devdocs-archive/2.2/assets/css/print.css?ver=7" media="print"/>

	<link rel="stylesheet" href="/devdocs-archive/2.2/common/css/devdocs.css" />
<link rel="alternate" type="application/rss+xml" title="Magento DevDocs RSS" href="/feed.xml" />



<meta name="google-site-verification" content="3WFsoYwBe6UuxDwgs7bmd7t0YFQVzDpLpWLjNh0CUp8" />

	<script>
  var baseUrl = "/devdocs-archive/2.2";
  var algolia = {
    id : "E642SEDTHL",
    index:  "devdocs",
    key:  "d2d0f33ab73e291ef8d88d8b565e754c",
  };

  var indices = [
    {
      label: "DevDocs",
      name: "devdocs",
      facetFilters: [["guide_version: 2.2", "versionless: true"]],
      refinements: [
        {
          label: "Functional areas",
          attribute: "functional_areas"
        }
      ],
      baseUrl: "https://devdocs.magento.com"
    },
    {
      label: "User Guide",
      name: "merchdocs_ee",
      baseUrl: "https://docs.magento.com/m2/ee/user_guide"
    },
    {
      label: "MBI User Guide",
      name: "merchdocs-mbi",
      baseUrl: "https://docs.magento.com/mbi"
    },
    {
      label: "Marketplace User Guide",
      name: "merchdocs-marketplace",
      baseUrl: "https://docs.magento.com/marketplace/user_guide"
    },
    {
      label: "PWA",
      name: "pwa-devdocs",
      baseUrl: "https://magento.github.io/pwa-studio"
    },
    {
      label: "Order Management",
      name: "oms-en",
      baseUrl: "https://omsdocs.magento.com"
    }
  ];
</script>




	<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="https://magento.com/favicon.ico">
	<link rel="apple-touch-icon" type="image/png" href="https://magento.com/apple-touch-icon.png">
	<link rel="apple-touch-icon" type="image/png" sizes="57x57" href="https://magento.com/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" type="image/png" sizes="72x72" href="https://magento.com/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="https://magento.com/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" type="image/png" sizes="114x114" href="https://magento.com/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="https://magento.com/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" type="image/png" sizes="144x144" href="https://magento.com/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="https://magento.com/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="https://magento.com/apple-touch-icon-180x180.png">

</head>
<body class="layout-default">


	<header class="site-header">
		

<nav class="site-nav">

  <div class="nav-container">

    <div class="menu-btn">
      <button id="menu-btn" class="menu-trigger menu-icon" aria-haspopup="true" aria-controls="nav-main" aria-label="Menu"></button>
    </div>

    <a class="logo" href="/devdocs-archive/2.2/">
      <img src="/devdocs-archive/2.2/assets/i/m-logo.svg" alt=""><img src="/devdocs-archive/2.2/assets/i/magento-logo.svg" alt="Magento" class="magento-logo" />
      <span class="site-logo">DevDocs</span>
    </a>

    <div id="nav-main" class="nav-main-wrap" aria-labelledby="menu-btn">
      


<div class="version-switcher dropdown">
	<button class="btn dropdown-toggle" disabled>
		Magento 2.2
	</button>
</div>


      <!-- Main Navigation --><ul class="nav-main" role="menubar"><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Cloud</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Cloud basics</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/bk-cloud.html">Cloud Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/architecture/cloud-architecture.html">Cloud Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/project/project-upgrade-parent.html">Upgrades and Patches</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/release-notes/cloud-tools.html">Release Notes</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Cloud development</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/setup/first-time-setup.html">Local development</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-config.html">Launch Docker</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/docker/docker-quick-reference.html">Docker quick reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/cloud/env/environments.html">Configure Environments</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Setup</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/install-gde/bk-install-guide.html">Installation Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/extensions/">Magento Extensions Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/comp-mgr/bk-compman-upgrade-guide.html">Software Update Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/config-guide/bk-config-guide.html">Configuration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/performance-best-practices/introduction.html">Performance Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/migration/bk-migration-guide.html">Migration Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Information</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/reference/cli/magento.html">Command-line Tools Reference</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Development</span><div class="nav-popup"><div class="nav-section">
              <div class="nav-section-title">Backend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/architecture/bk-architecture.html">Architecture</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">PHP Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ext-best-practices/bk-ext-best-practices.html">Extension Developer Best Practices</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mrg/intro.html">Module Reference Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/coding-standards/bk-coding-standards.html">Coding Standards</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/contributor-guide/contributing.html">Contributor Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">Frontend</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/frontend-dev-guide/bk-frontend-dev-guide.html">Frontend Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/ui_comp_guide/bk-ui_comps.html">UI Components Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/javascript-dev-guide/bk-javascript-dev-guide.html">JavaScript Developer Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/pattern-library/bk-pattern.html">Admin Design Pattern Library</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/design-styleguide/bk-styleguide.html">Admin Style Guide</a></li></ul>
            </div><div class="nav-section">
              <div class="nav-section-title">API</div>
              <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/bk-get-started-api.html">Get Started with Magento Web APIs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/bk-rest.html">REST API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/soap/bk-soap.html">SOAP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/marketplace/eqp/v1/api.html">Marketplace EQP API Reference</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mbi/docs/getting-started.html">Business Intelligence API</a></li></ul>
            </div></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Testing</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/testing.html">Magento Testing Guide</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/mftf/docs/introduction.html">Functional Acceptance Testing (MFTF)</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/mtf/mtf_introduction.html">Functional Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/integration/integration_test_execution.html">Integration Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/js/jasmine.html">JavaScript Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/test/unit/unit_test_execution.html">PHP Unit Testing</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/get-started/web-api-functional-testing.html">Web API Functional Testing</a></li></ul></div></li><li class="nav-main-separator"></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Functional Areas</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/advanced-reporting/overview.html">Advanced Reporting</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/b2b/bk-b2b.html">B2B</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/compliance/industry-compliance.html">Compliance</a></li><li class="" role="menuitem"><a href="http://omsdocs.magento.com/en/">Order Management</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/payments-integrations/bk-payments-integrations.html">Payment Integrations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/staging.html">Staging</a></li></ul></div></li><li class="nav-main-item" tabindex="0" role="menuitem" aria-haspopup="true">
    <span tabindex="-1">Tutorials</span><div class="nav-popup"><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/rest/tutorials/index.html">Rest Tutorials</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/customize_product.html">Customize Product Creation Form</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/checkout/checkout_overview.html">Customize Checkout</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/community/resources/support.html">Magento Support</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/videos/">Video Tutorials</a></li></ul></div></li></ul><!-- /.nav-main -->

    </div>

    <div class="nav-actions">
      
<div class="app-switcher">
  <div class="dropdown">
    <button id="app-switcher-trigger" class="app-switcher-trigger" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="Documentation sites"></button>
    <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="app-switcher-trigger" role="menu">
      <div class="app-switcher-content">
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Developer</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://devdocs.magento.com/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce Developer Documentation">Commerce Developer Documentation</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="http://pwastudio.io/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=PWA Studio">PWA Studio</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
      </div>
      
      <div class="app-switcher-group">
        <h3 class="app-swither-group-title">Merchant</h3>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/m2/ee/user_guide/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Commerce User Guide">Commerce User Guide</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://omsdocs.magento.com/en/userguides/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Order Management">Order Management</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/mbi/?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Business Intelligence">Business Intelligence</a></li>
        
        <li role="menuitem"><a class="dropdown-item" href="https://docs.magento.com/marketplace/user_guide/getting-started.html?itm_source=devdocs&itm_medium=top_nav&itm_campaign=app_switcher&itm_term=Marketplace">Marketplace</a></li>
        
      </div>
      
      </div>
    </ul>
  </div>
</div>


      <div class="search-btn">
        <button class="search-trigger search-icon" aria-label="Search"></button>
      </div>

      <form class="quick-search" action="/devdocs-archive/2.2/guides/v2.2/search.html" method="get" novalidate="novalidate">
        <input type="search" name="query" placeholder="Search" />
        <button class="quick-search-close" aria-label="Close Search">&times;</button>
      </form>

    </div>

  </div>

</nav><!-- #site-nav -->
<div class="nav-main-fader"></div>

	</header>

	<div class="global-wrapper">
		
		<div class="main-container">
			<a id="main-content"></a>


<div class="content-container">

	<!-- sidebar -->
<aside class="sidebar">
	<button class="toc-toggler">Table of Contents</button>
	<div class="sidebar-wrapper">

		

		<h4 class="guide-title">PHP Developer Guide</h4>
		<div class="collapsible-navigation">
		    <ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/bk-extension-dev-guide.html">Introduction</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/intro/developers_roadmap.html">Developer roadmap</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/intro/intro-composer.html">Introduction to Composer</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/intro/intro-composer-gloss.html">Glossary of common terms</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/prepare/prepare.html">Prepare (development quick start)</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/prepare/dev-modtypes.html">Component types</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/prepare/prepare_file-str.html">About component file structure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/prepare/dev-summary.html">Roadmap for developing and packaging components</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/prepare/lifecycle.html">Extension lifecycle</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/build.html">Build</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/di-xml-file.html">The di.xml file</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/optimal-dev-environment.html">Optimal development environment</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/composer-integration.html">The composer.json file</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/required-configuration-files.html">Define your configuration files</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/module-file-structure.html">Create your component file structure</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/component-registration.html">Register your component</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/XSD-XML-validation.html">URN schema validation</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/create_component.html">Name your component</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/module-load-order.html">Component load order</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/enable-module.html">Enable or disable your component</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/package/package.html">Package</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/package/package_module.html">Package a component</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/package/package_mktpl.html">Upload your component to the Magento Marketplace</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/validate/validate.html">Validate</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/validate/test-module.html">Test your component</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/partial-caching.html">Partial caching</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/partial-caching/database-caching.html">Create custom cache engines</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/partial-caching/create-cache-type.html">Create a cache type</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/page-caching.html">Full page caching</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/page-caching/public-content.html">Public content</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cache/page-caching/private-content.html">Private content</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cli-cmds/cli-add.html">Add CLI commands</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cli-cmds/cli-naming-guidelines.html">Command naming guidelines</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/cli-cmds/cli-howto.html">How to add CLI commands</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/staging.html">Staging (Magento Commerce only)</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/module-development.html">Component development</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/service-contracts/service-contracts.html">Service contracts</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/api-concepts.html">Public interfaces &amp; APIs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/service-contracts/design-patterns.html">Service contract design patterns</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/depend-inj.html">Dependency injection</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/object-manager.html">ObjectManager</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/events-and-observers.html">Events and observers</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/factories.html">Factories</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/proxies.html">Proxies</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/code-generation.html">Code generation</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/attributes.html">EAV and extension attributes</a></li><li class="active" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/plugins.html">Plugins (Interceptors)</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/routing.html">Routing</a></li><li class="" role="menuitem"><span>Indexing</span><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/indexing.html">Indexing overview</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/indexer-batch.html">Indexer optimization</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/indexing-custom.html">Adding a custom indexer</a></li></ul></li><li class="" role="menuitem"><span>Message Queues</span><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/message-queues/message-queues.html">Message queues overview</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/message-queues/config-mq.html">Configure message Queues</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/message-queues/queue-migration.html">Migrate message queue configuration</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/message-queues/bulk-operations.html">Bulk operations</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/message-queues/implement-bulk.html">Example bulk operations implementation</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/extension_attributes/adding-attributes.html">Adding extension attributes to entity</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/searching-with-repositories.html">Searching with repositories</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/service-contracts/service-to-web-service.html">Configure services as web APIs</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/webapi/request-processor-pool.html">WebApi request processors pool</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/howdoi/php/php_clear-dirs.html">Clear directories during development</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/adapters.html">Adapters</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/view-models.html">View models</a></li></ul></li><li class="" role="menuitem"><span>Configuration</span><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/configuration/sensitive-and-environment-settings.html">Sensitive Environment Settings</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/configuration/importers.html">Configuration Importers</a></li></ul></li><li class="" role="menuitem"><span>Framework</span><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/framework/serializer.html">Serialize Library</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/framework/array-manager.html">Array Manager</a></li></ul></li><li class="" role="menuitem"><span>Security</span><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/xss-protection.html">XSS Prevention</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/security/non-secure-functions.html">Non-secure functions</a></li></ul></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/versioning/">Versioning</a><ul><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/versioning/check-version.html">Check the Magento version</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/versioning/dependencies.html">Module version dependencies</a></li><li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/versioning/codebase-changes.html">Codebase changes</a></li></ul></li></ul>
		</div>

	</div>

</aside>
<!-- /sidebar -->


	<section class="content">
		<div class="content-wrap">
			<!-- page-header -->
<section class="page-intro">








<h1 class="page-heading">Plugins (Interceptors)</h1>
</section>

			<p>A plugin, or interceptor, is a class that modifies the behavior of public class functions by intercepting a function call and running code before, after, or around that function call. This allows you to <em>substitute</em> or <em>extend</em> the behavior of original, public methods for any <em>class</em> or <em>interface</em>.</p>

<p>Extensions that wish to intercept and change the behavior of a <em>public method</em> can create a <code class="language-plaintext highlighter-rouge">Plugin</code> class.</p>

<p>This <a href="https://glossary.magento.com/interception">interception</a> approach reduces conflicts among extensions that change the behavior of the same class or method. Your <code class="language-plaintext highlighter-rouge">Plugin</code> class implementation changes the behavior of a class function, but it does not change the class itself. Magento calls these interceptors sequentially according to a configured sort order, so they do not conflict with one another.</p>

<h2 id="limitations">Limitations</h2>

<p>Plugins can not be used on following:</p>

<ul>
  <li>Final methods</li>
  <li>Final classes</li>
  <li>Non-public methods</li>
  <li>Class methods (such as static methods)</li>
  <li><code class="language-plaintext highlighter-rouge">__construct</code></li>
  <li>Virtual types</li>
  <li>Objects that are instantiated before <code class="language-plaintext highlighter-rouge">Magento\Framework\Interception</code> is bootstrapped</li>
</ul>

<h2 id="declaring-a-plugin">Declaring a plugin</h2>

<p>The <code class="language-plaintext highlighter-rouge">di.xml</code> file in your <a href="https://glossary.magento.com/module">module</a> declares a plugin for a class object:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"{ObservedType}"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">"{pluginName}"</span> <span class="na">type=</span><span class="s">"{PluginClassName}"</span> <span class="na">sortOrder=</span><span class="s">"1"</span> <span class="na">disabled=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You must specify these elements:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">type name</code>. A class or interface which the plugin observes.</li>
  <li><code class="language-plaintext highlighter-rouge">plugin name</code>. An arbitrary plugin name that identifies a plugin. Also used to merge the configurations for the plugin.</li>
  <li><code class="language-plaintext highlighter-rouge">plugin type</code>. The name of a plugin’s class or its virtual type. Use the following naming convention when you specify this element: <code class="language-plaintext highlighter-rouge">\Vendor\Module\Plugin\&lt;ClassName&gt;</code>.</li>
</ul>

<p>The following elements are optional:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">plugin sortOrder</code>. Plugins that call the same method run them using this order.</li>
  <li><code class="language-plaintext highlighter-rouge">plugin disabled</code>. To disable a plugin, set this element to <code class="language-plaintext highlighter-rouge">true</code>. The default value is <code class="language-plaintext highlighter-rouge">false</code>.</li>
</ul>

<h3 id="defining-a-plugin">Defining a plugin</h3>

<p>By applying code before, after, or around a public method, a plugin extends or modifies that method’s behavior.</p>

<p>The first argument for the before, after, and around methods is an object that provides access to all public methods of the observed method’s class.</p>

<h3 id="plugin-method-naming-convention">Plugin method naming convention</h3>

<p>It is a Magento best practice to capitalize the first letter of the class method name for which you want to create a plugin before adding <code class="language-plaintext highlighter-rouge">before</code>, <code class="language-plaintext highlighter-rouge">around</code> or <code class="language-plaintext highlighter-rouge">after</code> prefixes to it.</p>

<p>For example, to create a plugin for the <code class="language-plaintext highlighter-rouge">setName</code> method of some class:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="mf">...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">setName</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="mf">...</span>
    <span class="p">}</span>
<span class="mf">...</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the plugin class, the <code class="language-plaintext highlighter-rouge">setName</code> method may have one of the following names:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">beforeSetName</code></li>
  <li><code class="language-plaintext highlighter-rouge">aroundSetName</code></li>
  <li><code class="language-plaintext highlighter-rouge">afterSetName</code></li>
</ul>

<p>If the first letter in the name of the class method name for which you want to create a plugin is the <code class="language-plaintext highlighter-rouge">underscore</code> character, then you do not need to capitalize it in the plugin class.</p>

<p>For example, to create a plugin for the <code class="language-plaintext highlighter-rouge">_construct</code> method of some class:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="mf">...</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">_construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="mf">...</span>
    <span class="p">}</span>
<span class="mf">...</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Use the following method names for the <code class="language-plaintext highlighter-rouge">_construct</code> method in the plugin class:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">before_construct</code></li>
  <li><code class="language-plaintext highlighter-rouge">around_construct</code></li>
  <li><code class="language-plaintext highlighter-rouge">after_construct</code></li>
</ul>

<h2 id="before-methods">Before methods</h2>

<p>Magento runs all before methods ahead of the call to an observed method. These methods must have the same name as the observed method with ‘before’ as the prefix.</p>

<p>You can use before methods to change the arguments of an observed method by returning a modified argument. If there is more than one argument, the method should return an array of those arguments. If the method does not change the argument for the observed method, it should return a <code class="language-plaintext highlighter-rouge">null</code> value.</p>

<p>Below is an example of a before method modifying the <code class="language-plaintext highlighter-rouge">$name</code> argument before passing it on to the observed <code class="language-plaintext highlighter-rouge">setName</code> method.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ProductAttributesUpdater</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">beforeSetName</span><span class="p">(</span><span class="err">\</span><span class="nc">Magento\Catalog\Model\Product</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">'('</span> <span class="mf">.</span> <span class="nv">$name</span> <span class="mf">.</span> <span class="s1">')'</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="after-methods">After methods</h2>

<p>Magento runs all after methods following the completion of the observed method. Magento requires these methods have a return value and they must have the same name as the observed method with ‘after’ as the prefix.</p>

<p>You can use these methods to change the result of an observed method by modifying the original result and returning it at the end of the method.</p>

<p>Below is an example of an after method modifying the return value <code class="language-plaintext highlighter-rouge">$result</code> of an observed methods call.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ProductAttributesUpdater</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">afterGetName</span><span class="p">(</span><span class="err">\</span><span class="nc">Magento\Catalog\Model\Product</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$result</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">'|'</span> <span class="mf">.</span> <span class="nv">$result</span> <span class="mf">.</span> <span class="s1">'|'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The after methods have access to all the arguments of their observed methods. When the observed method completes, Magento passes the result and arguments to the next after method that follows. If the observed method does not return a result (<code class="language-plaintext highlighter-rouge">@return void</code>), then it passes a <code class="language-plaintext highlighter-rouge">null</code> value to the next after method.</p>

<p>Below is an example of an after method that accepts the <code class="language-plaintext highlighter-rouge">null</code> result and arguments from the observed <code class="language-plaintext highlighter-rouge">login</code> method for <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Backend/Model/Auth.php" target="_blank"><code class="language-plaintext highlighter-rouge">Magento\Backend\Model\Auth</code></a>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">AuthLogger</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$logger</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="err">\</span><span class="nc">Psr\Log\LoggerInterface</span> <span class="nv">$logger</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cd">/**
     * @param \Magento\Backend\Model\Auth $authModel
     * @param null $result
     * @param string $username
     * @return void
     * @SuppressWarnings(PHPMD.UnusedFormalParameter)
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">afterLogin</span><span class="p">(</span><span class="err">\</span><span class="nc">Magento\Backend\Model\Auth</span> <span class="nv">$authModel</span><span class="p">,</span> <span class="nv">$result</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span><span class="o">-&gt;</span><span class="nf">debug</span><span class="p">(</span><span class="s1">'User '</span> <span class="mf">.</span> <span class="nv">$username</span> <span class="mf">.</span> <span class="s1">' signed in.'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>After methods do not need to declare all the arguments of their observed methods except those that the method uses and any arguments from the observed method that come before those used arguments.</p>

<p>The following example is a class with an after method for <a href="https://github.com/magento/magento2/blob/2.2/app/code/Magento/Catalog/Model/Product/Action.php" target="_blank"><code class="language-plaintext highlighter-rouge">\Magento\Catalog\Model\Product\Action::updateWebsites($productIds, $websiteIds, $type)</code></a>:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>
<span class="kd">class</span> <span class="nc">WebsitesLogger</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$logger</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="err">\</span><span class="nc">Psr\Log\LoggerInterface</span> <span class="nv">$logger</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span> <span class="o">=</span> <span class="nv">$logger</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">afterUpdateWebsites</span><span class="p">(</span><span class="err">\</span><span class="nc">Magento\Catalog\Model\Product\Action</span> <span class="nv">$subject</span><span class="p">,</span> <span class="nv">$result</span><span class="p">,</span> <span class="nv">$productIds</span><span class="p">,</span> <span class="nv">$websiteIds</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">logger</span><span class="o">-&gt;</span><span class="nb">log</span><span class="p">(</span><span class="s1">'Updated websites: '</span> <span class="mf">.</span> <span class="nb">implode</span><span class="p">(</span><span class="s1">', '</span><span class="p">,</span>  <span class="nv">$websiteIds</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

</pre></td></tr></tbody></table></code></pre></div></div>

<p>In the example, the <code class="language-plaintext highlighter-rouge">afterUpdateWebsites</code> function uses the variable <code class="language-plaintext highlighter-rouge">$websiteIds</code>, so it declares that variable as an argument. It also declares <code class="language-plaintext highlighter-rouge">$productIds</code> because it comes before <code class="language-plaintext highlighter-rouge">$websiteIds</code> in the parameter signature of the observed method. The after method did not list <code class="language-plaintext highlighter-rouge">$type</code> because it did not use it inside the method nor does it come before <code class="language-plaintext highlighter-rouge">$websiteIds</code>.</p>

<p class="bs-callout-warning">If an argument is optional in the observed method, then the after method should also declare it as optional.</p>

<h2 id="around-methods">Around methods</h2>

<p>Magento runs the code in around methods before and after their observed methods. Using these methods allow you to override an observed method. around methods must have the same name as the observed method with ‘around’ as the prefix.</p>

<p class="bs-callout-warning">Avoid using around method plugins when they are not required because they increase stack traces and affect performance.
The only use case for around method plugins is when the execution of all further plugins and original methods need termination.
Use after method plugins if you require arguments for replacing or altering function results.</p>

<p>Before the list of the original method’s arguments, around methods receive a <code class="language-plaintext highlighter-rouge">callable</code> that will allow a call to the next method in the chain. When your code executes the <code class="language-plaintext highlighter-rouge">callable</code>, Magento calls the next plugin or the observed function.</p>

<p class="bs-callout-warning">If the around method does not call the <code class="language-plaintext highlighter-rouge">callable</code>, it will prevent the execution of all the plugins next in the chain and the original method call.</p>

<p>Below is an example of an around method adding behavior before and after an observed method:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">ProductAttributesUpdater</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">aroundSave</span><span class="p">(</span><span class="err">\</span><span class="nc">Magento\Catalog\Model\Product</span> <span class="nv">$subject</span><span class="p">,</span> <span class="n">callable</span> <span class="nv">$proceed</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$someValue</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">doSmthBeforeProductIsSaved</span><span class="p">();</span>
        <span class="nv">$returnValue</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">canCallProceedCallable</span><span class="p">(</span><span class="nv">$someValue</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$returnValue</span> <span class="o">=</span> <span class="nv">$proceed</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$returnValue</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">postProductToFacebook</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$returnValue</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>When you wrap a method which accepts arguments, your plugin must accept those arguments and you must forward them when you invoke the <code class="language-plaintext highlighter-rouge">proceed</code> callable. You must be careful to match the default parameters and type hints of the original signature of the method.</p>

<p>For example, the following code defines a parameter of type <code class="language-plaintext highlighter-rouge">SomeType</code>, which is nullable:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Model</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyUtility</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">(</span><span class="kt">SomeType</span> <span class="nv">$obj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">//do something</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>You should wrap this method with a plugin:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyUtilityUpdater</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">aroundSave</span><span class="p">(</span><span class="err">\</span><span class="nc">My\Module\Model\MyUtility</span> <span class="nv">$subject</span><span class="p">,</span> <span class="n">callable</span> <span class="nv">$proceed</span><span class="p">,</span> <span class="nc">SomeType</span> <span class="nv">$obj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">//do something</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Note if you miss <code class="language-plaintext highlighter-rouge">= null</code> and Magento calls the original method with <code class="language-plaintext highlighter-rouge">null</code>, <a href="https://glossary.magento.com/php">PHP</a> would throw a fatal error as your plugin does not accept <code class="language-plaintext highlighter-rouge">null</code>.</p>

<p>You are responsible for forwarding the arguments from the plugin to the <code class="language-plaintext highlighter-rouge">proceed</code> callable. If you are not using/modifying the arguments, you could use variadics and argument unpacking to achieve this:</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kn">namespace</span> <span class="nn">My\Module\Plugin</span><span class="p">;</span>

<span class="kd">class</span> <span class="nc">MyUtilityUpdater</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">aroundSave</span><span class="p">(</span><span class="err">\</span><span class="nc">My\Module\Model\MyUtility</span> <span class="nv">$subject</span><span class="p">,</span> <span class="n">callable</span> <span class="nv">$proceed</span><span class="p">,</span> <span class="mf">...</span><span class="nv">$args</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="c1">//do something</span>
      <span class="nv">$proceed</span><span class="p">(</span><span class="mf">...</span><span class="nv">$args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="prioritizing-plugins">Prioritizing plugins</h2>

<p>The <code class="language-plaintext highlighter-rouge">sortOrder</code> property from the <code class="language-plaintext highlighter-rouge">plugin</code> node declared in <code class="language-plaintext highlighter-rouge">di.xml</code> determines the plugin’s prioritization when more than one plugin is observing the same method.</p>

<p>The <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Interception/PluginListInterface.php"><code class="language-plaintext highlighter-rouge">Magento\Framework\Interception\PluginListInterface</code></a> which is implemented by <a href="https://github.com/magento/magento2/blob/2.2/lib/internal/Magento/Framework/Interception/PluginList\PluginList.php"><code class="language-plaintext highlighter-rouge">Magento\Framework\Interception\PluginList\PluginList</code></a> is responsible to define when to call the before, around, or after methods respecting this prioritization.</p>

<p>If two or more plugins have the same <code class="language-plaintext highlighter-rouge">sortOrder</code> value or do not specify it, the <a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/module-load-order.html">component load order</a> declared in the <code class="language-plaintext highlighter-rouge">sequence</code> node from <code class="language-plaintext highlighter-rouge">module.xml</code> and <a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/build/di-xml-file.html#areas-and-application-entry-points">area</a> will define the merge sequence. Check the component load order in <code class="language-plaintext highlighter-rouge">app/etc/config.php</code> file.</p>

<p>Magento executes plugins using these rules during each plugin execution in two main flows:</p>

<ul>
  <li>Before the execution of the observed method, starting from lowest to highest <code class="language-plaintext highlighter-rouge">sortOrder</code>.
    <ul>
      <li>Magento executes the current plugin’s <code class="language-plaintext highlighter-rouge">before</code> method.</li>
      <li>Then the current plugin’s <code class="language-plaintext highlighter-rouge">around</code> method is called.
        <ul>
          <li>The first part of the plugin’s <code class="language-plaintext highlighter-rouge">around</code> method is executed.</li>
          <li>The <code class="language-plaintext highlighter-rouge">around</code> method executes the <code class="language-plaintext highlighter-rouge">callable</code>.
            <ul>
              <li>If there is another plugin in the chain, all subsequent plugins are wrapped in an independent sequence loop and the execution starts another flow.</li>
              <li>If the current plugin is the last in the chain, the observed method is executed.</li>
            </ul>
          </li>
          <li>The second part of the <code class="language-plaintext highlighter-rouge">around</code> method is executed.</li>
        </ul>
      </li>
      <li>Magento moves on to the next plugin.</li>
    </ul>
  </li>
  <li>Following the execution flow, starting from lowest to highest <code class="language-plaintext highlighter-rouge">sortOrder</code> in the current sequence plugins loop.
    <ul>
      <li>The current plugin’s <code class="language-plaintext highlighter-rouge">after</code> method is executed.</li>
      <li>Magento moves on to the next plugin.</li>
    </ul>
  </li>
</ul>

<p>As a result of these rules, the execution flow of an observed method is affected not only by the prioritization of the plugins, but also by their implemented methods.</p>

<p class="bs-callout-info">The <code class="language-plaintext highlighter-rouge">around</code> plugin’s method affects the flow of all plugins that are executed after it.</p>

<p class="bs-callout-tip">When the <code class="language-plaintext highlighter-rouge">before</code> and <code class="language-plaintext highlighter-rouge">around</code> plugin sequence is finished, Magento calls the first plugin <code class="language-plaintext highlighter-rouge">after</code> method in the sequence loop, and not the <code class="language-plaintext highlighter-rouge">after</code> method of the current plugin that was being executed by the <code class="language-plaintext highlighter-rouge">around</code> method.</p>

<h3 id="examples">Examples</h3>

<p>For example, the <code class="language-plaintext highlighter-rouge">di.xml</code> file of your module attaches three plugins for the class <code class="language-plaintext highlighter-rouge">Action</code>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlighter"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;config&gt;</span>
    <span class="nt">&lt;type</span> <span class="na">name=</span><span class="s">"Magento\Framework\App\Action\Action"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">"vendor_module_plugina"</span> <span class="na">type=</span><span class="s">"Vendor\Module\Plugin\PluginA"</span> <span class="na">sortOrder=</span><span class="s">"10"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">"vendor_module_pluginb"</span> <span class="na">type=</span><span class="s">"Vendor\Module\Plugin\PluginB"</span> <span class="na">sortOrder=</span><span class="s">"20"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;plugin</span> <span class="na">name=</span><span class="s">"vendor_module_pluginc"</span> <span class="na">type=</span><span class="s">"Vendor\Module\Plugin\PluginC"</span> <span class="na">sortOrder=</span><span class="s">"30"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/type&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>The execution will have a different flow, depending on the methods implemented by these classes, as explained in the following scenarios.</p>

<h4 id="scenario-a">Scenario A</h4>

<p>Your plugin classes has this methods:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>PluginA</th>
      <th>PluginB</th>
      <th>PluginC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>sortOrder</strong></td>
      <td>10</td>
      <td>20</td>
      <td>30</td>
    </tr>
    <tr>
      <td><strong>before</strong></td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
    </tr>
    <tr>
      <td><strong>around</strong></td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>after</strong></td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
    </tr>
  </tbody>
</table>

<p>The execution will be in this order:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PluginA::beforeDispatch()</code></li>
  <li><code class="language-plaintext highlighter-rouge">PluginB::beforeDispatch()</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PluginC::beforeDispatch()</code></p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">Action::dispatch()</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">PluginA::afterDispatch()</code></li>
  <li><code class="language-plaintext highlighter-rouge">PluginB::afterDispatch()</code></li>
  <li><code class="language-plaintext highlighter-rouge">PluginC::afterDispatch()</code></li>
</ul>

<h4 id="scenario-b">Scenario B</h4>

<p>Your plugin classes has this methods:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>PluginA</th>
      <th>PluginB</th>
      <th>PluginC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>sortOrder</strong></td>
      <td>10</td>
      <td>20</td>
      <td>30</td>
    </tr>
    <tr>
      <td><strong>before</strong></td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
    </tr>
    <tr>
      <td><strong>around</strong></td>
      <td> </td>
      <td>aroundDispatch()</td>
      <td> </td>
    </tr>
    <tr>
      <td><strong>after</strong></td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
    </tr>
  </tbody>
</table>

<p>The execution will be in this order:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PluginA::beforeDispatch()</code></li>
  <li><code class="language-plaintext highlighter-rouge">PluginB::beforeDispatch()</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PluginB::aroundDispatch()</code> (Magento calls the first half until <code class="language-plaintext highlighter-rouge">callable</code>)</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">PluginC::beforeDispatch()</code></p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">Action::dispatch()</code></li>
        </ul>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">PluginC::afterDispatch()</code></p>
      </li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">PluginB::aroundDispatch()</code> (Magento calls the second half after <code class="language-plaintext highlighter-rouge">callable</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">PluginA::afterDispatch()</code></li>
  <li><code class="language-plaintext highlighter-rouge">PluginB::afterDispatch()</code></li>
</ul>

<h4 id="scenario-c">Scenario C</h4>

<p>Your plugin classes has this methods:</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>PluginA</th>
      <th>PluginB</th>
      <th>PluginC</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>sortOrder</strong></td>
      <td>10</td>
      <td>20</td>
      <td>30</td>
    </tr>
    <tr>
      <td><strong>before</strong></td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
      <td>beforeDispatch()</td>
    </tr>
    <tr>
      <td><strong>around</strong></td>
      <td>aroundDispatch()</td>
      <td> </td>
      <td>aroundDispatch()</td>
    </tr>
    <tr>
      <td><strong>after</strong></td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
      <td>afterDispatch()</td>
    </tr>
  </tbody>
</table>

<p>The execution will be in this order:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">PluginA::beforeDispatch()</code></li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PluginA::aroundDispatch()</code> (Magento calls the first half until <code class="language-plaintext highlighter-rouge">callable</code>)</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">PluginB::beforeDispatch()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PluginC::beforeDispatch()</code></li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">PluginC::aroundDispatch()</code> (Magento calls the first half until <code class="language-plaintext highlighter-rouge">callable</code>)</p>

        <ul>
          <li><code class="language-plaintext highlighter-rouge">Action::dispatch()</code></li>
        </ul>
      </li>
      <li><code class="language-plaintext highlighter-rouge">PluginC::aroundDispatch()</code> (Magento calls the second half after <code class="language-plaintext highlighter-rouge">callable</code>)</li>
      <li><code class="language-plaintext highlighter-rouge">PluginB::afterDispatch()</code></li>
      <li><code class="language-plaintext highlighter-rouge">PluginC::afterDispatch()</code></li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">PluginA::aroundDispatch()</code> (Magento calls the second half after <code class="language-plaintext highlighter-rouge">callable</code>)</li>
  <li><code class="language-plaintext highlighter-rouge">PluginA::afterDispatch()</code></li>
</ul>

<h2 id="configuration-inheritance">Configuration inheritance</h2>

<p>Classes and interfaces that are implementations of or inherit from classes that have plugins will also inherit plugins from the parent class.</p>

<p>Magento uses plugins defined in the global scope when the system is in a specific area (such as frontend or backend). You can extend or override these global plugin configurations with an area’s <code class="language-plaintext highlighter-rouge">di.xml</code> file.</p>

<p>For example, the developer can disable a global plugin in the <a href="https://glossary.magento.com/backend">backend</a> area by disabling it in the specific <code class="language-plaintext highlighter-rouge">di.xml</code> file for the backend area.</p>

<p class="ref-header">Related topics</p>

<ul>
  <li><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/depend-inj.html">Dependency injection</a></li>
  <li><a href="/devdocs-archive/2.2/guides/v2.2/extension-dev-guide/events-and-observers.html">Events and observers</a></li>
  <li><a href="http://vinaikopp.com/2016/03/07/04_the_plugin_integration_test_kata" target="_blank">The Plugin Integration Test Kata</a> by Magento contributor <a href="http://vinaikopp.com/blog/list" target="_blank">Vinai Kopp</a></li>
  <li><a href="http://vinaikopp.com/2016/02/22/03_the_around_interceptor_kata" target="_blank">The Around Interceptor Kata</a> by Magento contributor <a href="http://vinaikopp.com/blog/list" target="_blank">Vinai Kopp</a></li>
</ul>

			
		</div>
		<!-- /.content-wrap -->

		<div class="page-info">

  
  <div class="page-updated">
    <img src="/devdocs-archive/2.2/i/icons/time.svg" alt="Updated" />
    <time id="last-modified-at" itemprop="dateModified" datetime="2019-12-17">
      Dec 17th, 2019
    </time>
  </div>
  

  

  

  

</div>


	</section>
	<!-- /.content -->

</div> <!-- /.content-container -->


	</div>
	<!-- /.main-container -->
</div>
<!-- /#gl-wrapper -->

<!-- footer-->
<div class="page-footer">
  <div class="container">

    <div class="copyright-links">
      

<ul class="nav footer-links" role="menu">

  <li class="" role="menuitem"><a href="https://github.com/magento/devdocs/blob/master/.github/CONTRIBUTING.md">Become a Contributor</a></li>

  <li class="" role="menuitem"><a href="https://glossary.magento.com/">Glossary</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/privacy/">Privacy Policy</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/terms/">Terms of Service</a></li>

  <li class="" role="menuitem"><a href="https://magento.com/legal/licensing/">License/Trademark FAQ</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/bk-release-notes.html">Release Notes</a></li>

  <li class="" role="menuitem"><a href="/devdocs-archive/2.2/guides/v2.2/release-notes/packages-open-source.html">Third-Party Licenses</a></li>

</ul>

    </div>

		<div class="copyright-date">&copy; 2023 Magento. All rights reserved.</div>

  </div>
</div>
<!-- / #footer -->


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="/devdocs-archive/2.2/assets/js/app.min.js?ver=7"></script>





<script type="text/javascript" src="/devdocs-archive/2.2/common/js/last-modified-at.js"></script>
<script type="text/javascript" src="/devdocs-archive/2.2/common/js/glossary-link-enhancer.js"></script>


</body>
</html>

